"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var crowdin_ajax=function(_CrowdinComponent){_inherits(crowdin_ajax,_CrowdinComponent);var _super=_createSuper(crowdin_ajax);function crowdin_ajax(){var _this;_classCallCheck(this,crowdin_ajax);_this=_super.call(this);_this.NOT_LOGGED_IN_RESPONSE_TYPE=2;_this.hideNotifications=false;_this.loadingTimeout=null;_this.aclError=false;_this.messages=[];_this.lockedActions=[];$("body").append('<div id="loading_block"><div></div></div>');return _this}_createClass(crowdin_ajax,[{key:"complete",value:function complete(message){if(!message){return}for(var i=0;i<this.messages.length;i++){if(this.messages[i]===message){this.messages.splice(i,1);break}}if(this.messages.length){$("#loading_block > div").html(this.messages[this.messages.length-1])}else{$("#loading_block").hide()}}},{key:"start",value:function start(message){if(!message){return}var self=this;clearTimeout(this.loadingTimeout);this.messages.push(message);$("#loading_block > div").html(message);$("#loading_block").show();this.loadingTimeout=setTimeout((function(){self.messages=[];$("#loading_block").hide()}),12e4)}},{key:"active",value:function active(){return $.active}},{key:"getData",value:function getData(url,data,callback,message,hideNotifications,processLegacyResponse){return this.makeRequest({url:url,method:"get",data:data,callback:callback,message:message,hideNotifications:hideNotifications,processLegacyResponse:processLegacyResponse})}},{key:"postData",value:function postData(url,data,callback,message,hideNotifications,processLegacyResponse){this.makeRequest({url:url,method:"post",data:data,callback:callback,message:message,hideNotifications:hideNotifications,processLegacyResponse:processLegacyResponse})}},{key:"makeRequest",value:function makeRequest(requestData){var lockKey=null;this.start(requestData.message);if(requestData.data){lockKey=requestData.data._lockKey;delete requestData.data._lockKey}this.lock(lockKey);return $[requestData.method](requestData.url,requestData.data,function(response){this.unlock(lockKey);this.processResponse(response,requestData.hideNotifications);this.aclError=!check_acl(response);if(!requestData.processLegacyResponse&&requestData.callback&&response.data&&!this.aclError){requestData.callback(response.data)}if(requestData.callback&&requestData.processLegacyResponse&&!this.aclError){requestData.callback(response)}this.complete(requestData.message)}.bind(this),"json")}},{key:"processResponse",value:function processResponse(response,hideNotifications){var self=this;if(response.notifications&&hideNotifications!==true){for(var i in response.notifications){$.jGrowl(response.notifications[i].message)}}if(response.status){for(var i in response.status){self.start(response.status[i].message);setTimeout((function(){self.complete(response.status[i].message)}),response.status[i].livetime)}}if(response.redirect){crowdin.helpers.url.redirect(response.redirect)}if(response.version&&window.CROWDIN_VERSION&&response.version!==window.CROWDIN_VERSION){self.showOutdatedMessage()}}},{key:"showNotLoggedInMessage",value:function showNotLoggedInMessage(){if($("#not-logged-in").length){return}$("body").mask();$("body > .loadmask").css({"z-index":1e6,position:"fixed"});var tpl='\n      <div id="not-logged-in" class="reload-msg" style="display: flex">\n          <div class="not-logged-in-warning"></div>\n          <div style="width: 90%">\n            <p style="margin-bottom: 5px;">You\'re not logged in</p><button autofocus="" class="btn btn-small" id="login_button">Log in</button>\n          </div>\n      </div>\n    ';$("body").append(tpl)}},{key:"showOutdatedMessage",value:function showOutdatedMessage(){if($("#reload_msg").length){return}$("body").mask();$("body > .loadmask").css({"z-index":1e6,position:"fixed"});var tpl=""+'<div id="reload_msg" class="reload-msg">'+_l("ajax.siteHasJustBeenUpdated",{siteName:branding.getName()})+'<div class="btn-toolbar no-margin-bottom">'+'<button autofocus class="btn btn-primary" onClick="top.location.reload();">'+_l("generic.reload")+"</button>"+'<button class="btn" id="reload_msg_ignore">'+_l("generic.ignore")+"</button>"+"</div>"+"</div>";$("body").append(tpl);$("#reload_msg_ignore").click((function(){$("#reload_msg").hide();$("body").unmask()}))}},{key:"lock",value:function lock(params){if(!params||_typeof(params)!=="object"){return}this.lockedActions.push(params.join("_"))}},{key:"isLocked",value:function isLocked(params){return this.lockedActions.indexOf(params.join("_"))>-1}},{key:"unlock",value:function unlock(params){if(!params||_typeof(params)!=="object"){return}var index=this.lockedActions.indexOf(params.join("_"));if(index>-1){this.lockedActions.splice(index,1)}}}]);return crowdin_ajax}(CrowdinComponent);
