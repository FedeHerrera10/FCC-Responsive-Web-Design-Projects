"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var checklist_single=function(_CrowdinComponent){_inherits(checklist_single,_CrowdinComponent);var _super=_createSuper(checklist_single);function checklist_single(options){var _this;_classCallCheck(this,checklist_single);_this=_super.call(this);_this.filter_template=""+'<div class="filter-list-toolbar checklist-signle-js-filter">'+'<input type="text" class="no-margin input-block-level"/>'+'<a href="#" tabindex="-1" class="transparent hidden clear-filter-query">'+'<i class="static-icon static-icon-squared-cross"></i>'+"</a>"+"</div>";_this.options={list_selector:"",filter_selector:"",result_selector:"",result_placeholder:"",change:function change(){},render:function render(){},item_tpl:function item_tpl(item){return""+'<li data-id="'+item.id+'" class="'+(item.disabled?"disabled":"")+'">'+htmlspecialchars(item.name)+this.get_item_title(item)+"</li>"},result_tpl:function result_tpl(item){return""+'<span data-id="'+item.id+'" title="'+htmlspecialchars(item.name)+'">'+htmlspecialchars(item.name)+this.get_item_title(item)+"</span>"},get_item_title:function get_item_title(item){return item.title!=null&&item.title.length>0?' <span class="muted">('+htmlspecialchars(item.title)+")</span>":""},data:[],filter_placeholder:"",empty_result_msg:"",limit:0,event_namespace:""};_this.select=null;_this.ns="";_this.rgx=null;_this.ready=false;_this.selected_item_id=null;_this.is_mobile=navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i);_this.options=$.extend({},_this.options,options);if(_this.options.event_namespace){_this.ns+="."+_this.options.event_namespace}_this.make_filter();_this.bind_events();_this.update();_this.ready=true;return _this}_createClass(checklist_single,[{key:"update",value:function update(){this.render();this.options.change(this.selected_item_id,this);if(this.options.result_selector){this.render_result()}}},{key:"render",value:function render(){var self=this;var html="";for(var i=0;i<this.options.data.length;i++){var c=1;var group=this.options.data[i];var title=group.title?"<div>"+group.title+"</div>":"";var items_html="";for(var j=0;j<group.data.length;j++){var item=group.data[j];var i_name=item.name;var i_title=item.title||"";if(self.search_query&&!(self.rgx.test(i_title)||self.rgx.test(i_name))){continue}if(Object.keys(item).length){items_html+=self.options.item_tpl(item)}if(self.options.limit&&self.options.limit<++c){break}}if(items_html){html+='<div class="checklist-single-group">'+title+"<ul>"+items_html+"</ul></div>"}}if(!html){html='<div class="checklist-single-group"><ul><li class="disabled">'+this.options.empty_result_msg+"</li></ul></div>"}$(this.options.list_selector).addClass("checklist-single-js unselectable").html(html);setTimeout((function(){self.select.select('[data-id="'+self.selected_item_id+'"]')}),0);this.options.render(this)}},{key:"render_result",value:function render_result(){var result_html=this.options.result_placeholder?this.options.result_placeholder:"&nbsp;";var item=this.get_item(this.selected_item_id);if(Object.keys(item).length){result_html=this.options.result_tpl(item)}$(this.options.result_selector).addClass("checklist-single-js-result unselectable").html(result_html);var btn=$(this.options.result_selector).closest(".dropdown-toggle");if(btn.parent().hasClass("open")){btn.parent().removeClass("open");btn.focus()}}},{key:"get_item",value:function get_item(id){var item=this.get_items_by_condition((function(item){return+item.id===+id}));return item.length?item[0]:{}}},{key:"get_items_by_condition",value:function get_items_by_condition(fn){var items=[];for(var i=0;i<this.options.data.length;i++){var group=this.options.data[i];for(var j=0;j<group.data.length;j++){if(fn(group.data[j])){items.push(group.data[j])}}}return items}},{key:"bind_events",value:function bind_events(){var self=this;this.select=new select({container:self.options.list_selector,selector:"li:not(.disabled)",open_handler:"click",event_namespace:self.options.event_namespace,open_fn:function open_fn(item_el){if(!item_el.hasClass("disabled")){self.choose_item(item_el)}},singleselect:true,scroll_offset:0,smooth_scroll:false});if(self.filter_block&&!self.is_mobile){$(self.options.result_selector).closest(".dropdown-toggle").click((function(){var button=$(this);setTimeout((function(){if(button.parent().hasClass("open")){self.filter_block.find("input").focus()}}),0)}))}}},{key:"focus",value:function focus(){var x=window.scrollX||window.pageXOffset,y=window.scrollY||window.pageYOffset;$(this.options.list_selector).focus();window.scrollTo(x,y)}},{key:"choose_item",value:function choose_item(item_el){this._choose_item(item_el.data("id"))}},{key:"_choose_item",value:function _choose_item(id){this.selected_item_id=id;this.select.select('[data-id="'+id+'"]');this.options.change(id,this);if(this.options.result_selector){this.render_result()}}},{key:"make_filter",value:function make_filter(){if(this.options.filter_selector===""){return}function escape_rgx(str){return str.replace(/[\-\[\]\/\{\}\(\)\+\.\\\^\$\|]/g,"\\$&").replace(/\*/g,".*").replace(/\?/g,".")}var self=this;var rebuild_timeout=0;self.filter_block=$(self.filter_template);var input=self.filter_block.find("input");var clear_btn=self.filter_block.find(".clear-filter-query");input.attr("placeholder",self.options.filter_placeholder);$(self.options.filter_selector).empty();self.filter_block.appendTo(self.options.filter_selector);input.on("input"+self.ns,(function(){clearTimeout(rebuild_timeout);rebuild_timeout=setTimeout((function(){self.search_query=input.val();var regexp=escape_rgx(self.search_query);if(/\*|\?/i.test(self.search_query)){regexp="^"+regexp+"$"}self.rgx=new RegExp(regexp,"im");self.render();self.select.select(":first");clear_btn[input.val()===""?"addClass":"removeClass"]("hidden")}),350)}));$(input).on("click"+self.ns,(function(e){e.stopPropagation()}));input.on("keydown"+self.ns,(function(e){setTimeout((function(){if([38,40,13].indexOf(e.which)!==-1){var te=$.Event("keydown");te.which=e.which;self.select.$container.trigger(te)}}),0)}));clear_btn.on("click"+self.ns,(function(){$(this).addClass("hidden");input.val("").focus();self.search_query="";self.rgx=new RegExp(self.search_query,"im");self.render();return false}))}}]);return checklist_single}(CrowdinComponent);
