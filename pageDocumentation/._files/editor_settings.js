"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var crowdin_editor_settings=function(_crowdin_plugin){_inherits(crowdin_editor_settings,_crowdin_plugin);var _super=_createSuper(crowdin_editor_settings);_createClass(crowdin_editor_settings,null,[{key:"colorScheme",value:function colorScheme(){return{default:"default",light:"light",dark:"dark;"}}}]);function crowdin_editor_settings(){var _this;_classCallCheck(this,crowdin_editor_settings);_this=_super.call(this,{buttonId:"#action_editor_settings",hotkey:false});_this.min_tm_match_value=40;return _this}_createClass(crowdin_editor_settings,[{key:"setup",value:function setup(){if($("#editor_settings_dialog").length===0){$("body").append(this.getSettingsDialog());crowdin.editor.jipt_mode&&$("#phrases_view").hide()}this.init_dialog();this.bind_events();this.init_content()}},{key:"run",value:function run(){$("#editor_settings_dialog").dialog("open")}},{key:"close",value:function close(){$("#editor_settings_dialog").dialog("close")}},{key:"bind_events",value:function bind_events(){$("#tm_match_value").change((function(){var val=parseInt($(this).val());val=isNaN(val)?0:val;$(this).val(val)}));$("#tm_match_value").on("input",(function(){$("#tm_match_label").text(sprintf("%s%",this.value))}));$("#editor_show_placeholders").find(".btn").click((function(){$(this).addClass("active").siblings().removeClass("active")}));$("#editor_color_theme").children(".btn").click((function(event){var colorScheme=event.target.dataset.value;crowdin.editor.setColorTheme(colorScheme);$(event.target).addClass("active").siblings().removeClass("active")}));if(window.matchMedia("(prefers-color-scheme)").media!=="not all"){var darkModeMediaQuery=window.matchMedia("(prefers-color-scheme: dark)");darkModeMediaQuery.addListener((function(e){if(crowdin.user.settings.editor_color_theme===crowdin_editor_settings.colorScheme()["default"]){crowdin.editor.setColorTheme(e.matches?crowdin_editor_settings.colorScheme().dark:crowdin_editor_settings.colorScheme().light)}}))}}},{key:"init_dialog",value:function init_dialog(){var self=this;$("#editor_settings_dialog").dialog({autoOpen:false,width:540,resizable:false,draggable:!IS_MOBILE,modal:true,buttons:this._getButtons(),open:function open(e,ui){if(crowdin.editor.jipt_mode){$("#editor_settings_dialog").css({top:"0px"}).siblings(".ui-dialog-titlebar").hide()}crowdin.editor.fit_dialog($(this))},close:function close(e,ui){self.close_editor_settings_dialog()}});$("#editor_settings_dialog").on("dialogopen",(function(){$("#action_editor_settings").addClass("active")})).on("dialogclose",(function(){$("#action_editor_settings").removeClass("active")}))}},{key:"init_content",value:function init_content(){$("#tm_match_value").attr({min:this.min_tm_match_value,max:100}).val(crowdin.user.settings.tm_matching_value||this.min_tm_match_value).trigger("input");$("#editor_show_placeholders .btn[data-value='"+crowdin.user.settings.editor_show_placeholders+"']").addClass("active").siblings().removeClass("active");$("#editor_color_theme .btn[data-value='"+crowdin.user.settings.editor_color_theme+"']").addClass("active").siblings().removeClass("active");$("#phrase_single_line").prop("checked",!crowdin.user.settings.action_phrase_completely);$("#non_blocked_validators").prop("checked",!crowdin.user.settings.disable_non_blocked_validators);$("#editor_autocomplete").prop("checked",crowdin.user.settings.enable_autocomplete)}},{key:"_getButtons",value:function _getButtons(){var self=this;var buttons={};buttons[_l("generic.cancel")]=function(){$("#editor_settings_dialog").dialog("close")};buttons[_l("generic.save")]=function(){self.saveEditorSettings()};return buttons}},{key:"saveEditorSettings",value:function saveEditorSettings(){var self=this;var tm_matching_value=parseInt($("#tm_match_value").val());crowdin.user.settings.action_phrase_completely=!$("#phrase_single_line").is(":checked");var editor_show_placeholders=String($("#editor_show_placeholders").find(".btn.active").data("value"));if(editor_show_placeholders!==crowdin.user.settings.editor_show_placeholders){crowdin.user.settings.editor_show_placeholders=editor_show_placeholders;crowdin.highlight.init_regexps()}var editor_color_theme=$("#editor_color_theme").find(".btn.active").data("value");if(editor_color_theme!==crowdin.user.settings.editor_color_theme){crowdin.user.settings.editor_color_theme=editor_color_theme}if(tm_matching_value<self.min_tm_match_value||tm_matching_value>100){var msg=_l("editor.similarityPercent",{minValue:self.min_tm_match_value});$("#tm_match_value").focus().closest(".control-group").addClass("error has-error").find(".help-block").html(msg);return}else{crowdin.user.settings.tm_matching_value=tm_matching_value;$("#tm_match_value").closest(".control-group").removeClass("error has-error").find(".help-block").empty()}crowdin.user.settings.disable_non_blocked_validators=$("#non_blocked_validators").is(":checked")?false:true;crowdin.user.settings.enable_autocomplete=$("#editor_autocomplete").is(":checked")?true:false;$("#editor_settings_dialog").dialog("close");if(crowdin.translation){crowdin.phrases.markup_replacers.clear();crowdin.models.mt.storage.clear();crowdin.models.external_suggestions.storage.clear()}if(crowdin.phrases.version==="html"){crowdin.translation.refresh()}else{!crowdin.editor.jipt_mode&&crowdin.phrases.refresh();crowdin.editor.jipt_mode&&crowdin.translation.translation_id&&crowdin.translation.refresh()}crowdin.ajax.postData("/user_settings/update",{settings:JSON.stringify(crowdin.user.settings)},(function(data){if(!data.success){crowdin.notify(data.msg||_l("editor.stringsSaveError"),{type:"error"})}else{crowdin.hotkeys.bindHotkeys()}}),null,false,true)}},{key:"close_editor_settings_dialog",value:function close_editor_settings_dialog(){this.init_content();crowdin.editor.setColorTheme(crowdin.user.settings.editor_color_theme);crowdin.editor.jipt_mode&&crowdin.jipt.sendMessage({msg_type:"close_editor_settings"})}},{key:"getSettingsDialog",value:function getSettingsDialog(){return""+'<div id="editor_settings_dialog" class="hide" title="'+_l("editor.editorSettings")+'">'+'<div class="editable_name control-group">'+"<p>"+_l("editor.minimumSimilarityMatch")+"</p>"+'<label for="tm_match_value" class="control-label">'+'<input id="tm_match_value" class="input-mini center" type="range" name="tm_match_value"/>'+'<span id="tm_match_label"></span>'+"</label>"+'<div class="help-block small"></div>'+"</div>"+(!crowdin.editor.modeReview()?'<div class="control-group b-margin-top" id="phrases_view">'+'<label class="checkbox">'+'<input type="checkbox" id="phrase_single_line" name="phrases_view">'+_l("editor.compactStringsListView")+"</label>"+'<div class ="help-block small no-margin">'+_l("editor.compactStringsListViewDescription")+"</div>"+"</div>"+'<div class="control-group b-margin-top">'+'<label class="checkbox">'+'<input type="checkbox" id="non_blocked_validators" name="disable_non_blocked_validators">'+_l("editor.qaIssues")+"</label>"+'<div class ="help-block small no-margin">'+_l("editor.qaChecksDescription")+"</div>"+"</div>":"")+(!IS_MOBILE&&!crowdin.editor.modeReview()?'<div class="control-group b-margin-top">'+'<label class="checkbox">'+'<input type="checkbox" id="editor_autocomplete" name="enable_autocomplete">'+_l("editor.autocomplete")+"</label>"+'<div class ="help-block small no-margin">'+_l("editor.autocompleteDescription")+"</div>"+"</div>":"")+'<div class="control-group b-margin-top">'+'<label class="disabled">'+_l("editor.htmlTagsDisplaying")+"</label>"+'<div id="editor_show_placeholders">'+'<div class="btn-group" style="margin-bottom: 10px;">'+'<button data-value="default" type="button" class="btn btn-small">'+_l("editor.htmlAuto")+"</button>"+'<button data-value="false" type="button" class="btn btn-small">'+_l("editor.htmlShow")+"</button>"+'<button data-value="true" type="button" class="btn btn-small">'+_l("editor.htmlHide")+"</button>"+"</div>"+'<div class ="help-block small no-margin">'+_l("editor.htmlAutoDescription")+"</div>"+"</div>"+"</div>"+'<div class="control-group b-margin-top">'+'<label class="disabled">'+_l("editor.colorTheme")+"</label>"+'<div id="editor_color_theme" class="btn-group">'+'<button data-value="'.concat(crowdin_editor_settings.colorScheme()["default"],'" type="button" class="btn btn-small">').concat(_l("editor.colorThemeDefault"),"</button>")+'<button data-value="'.concat(crowdin_editor_settings.colorScheme().light,'" type="button" class="btn btn-small">').concat(_l("editor.colorThemeLight"),"</button>")+'<button data-value="'.concat(crowdin_editor_settings.colorScheme().dark,'" type="button" class="btn btn-small">').concat(_l("editor.colorThemeDark"),"</button>")+"</div>"+"</div>"+"</div>"}}]);return crowdin_editor_settings}(crowdin_plugin);
