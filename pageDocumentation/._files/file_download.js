"use strict";function prepare_download_file_dialog(title,as_xliff,filter){var dialog_html=""+"<div>"+'<div class="progress progress-striped active">'+'<div class="bar bar-gray" style="width: 100%;"></div>'+"</div>"+"<p>"+_l("fileDownload.exportInProgress")+"</p>"+"</div>";var aborted=false;var buttons={};buttons[_l("generic.cancel")]=function(){aborted=true;$(this).dialog("close")};var $downloadFileDialog=$("#download_file_dialog");$downloadFileDialog.dialog({resizable:false,autoOpen:false,width:600,modal:true,buttons:buttons});$downloadFileDialog.dialog("option","title",htmlspecialchars(title));$downloadFileDialog.html(dialog_html);$("#download_file_dialog").dialog("open");var exportParams={as_xliff:as_xliff,task:crowdin.editor.getTaskHash()};if(filter&&as_xliff){exportParams.editor_filter=JSON.stringify(filter)}var exportUrl=sprintf("/project/%s/%s/%s/export",crowdin.editor.project.identifier,crowdin.editor.target_language.internal_code,crowdin.editor.file.id);crowdin.ajax.getData(exportUrl,exportParams,(function(data){if(aborted){return}var buttons={};buttons[_l("generic.close")]=function(){$(this).dialog("close")};$downloadFileDialog.dialog("option","buttons",buttons);if(data.success&&data.url){$("#download_file_dialog").dialog("close");$.jGrowl(_l("fileDownload.downloading"),{theme:"jGrowl-notice"});crowdin.helpers.url.redirect(data.url)}else{var message=data.msg?data.msg:_l("error.internalError");if(data.acl_error){message=IS_ENTERPRISE?data.data.error.message:data.msg}$("#download_file_dialog").html('<div class="alert alert-error">'+message+"</div>")}}),null,false,true)}
