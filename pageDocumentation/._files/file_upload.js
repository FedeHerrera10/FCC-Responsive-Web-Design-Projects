"use strict";var TYPE_FILE,FILE_EXTENSION,MSG_UPLOAD_FILE_INIT='<div class="upload_option_item control-group">'+'<label for="import_eq_suggestions" class="checkbox">'+'<input type="checkbox" id="import_eq_suggestions" value="import_eq_suggestions" />'+_l("fileUpload.importSuggestionsMatchingSourceStrings")+"</label>"+"</div>",MSG_APPROVE_INPUT='<div class="upload_option_item control-group">'+'<label for="auto_approve_imported" class="checkbox">'+'<input type="checkbox" id="auto_approve_imported" value="auto_approve_imported" />'+_l("fileUpload.autoApproveImported")+"</label>"+"</div>",MSG_TRANSLATE_HIDDEN='<div class="upload_option_item control-group">'+'<label for="translate_hidden" class="checkbox">'+'<input type="checkbox" id="translate_hidden" value="translate_hidden" />'+_l("fileUpload.translateHidden")+"</label>"+"</div>",MSG_UPLOAD_FILE_PROCESS='<div class="margin-top" style="text-align: center; height: 50px;">'+'<img style="margin-top:15px" src="'+CDN+'/crowdin-editor/public/assets/ajax-loader.gif" />'+"</div>"+'<h4 class="center">'+'<i class="static-icon static-icon-hourglass i-margin-right"></i>'+_l("fileUpload.uploadInProgress")+"</h4>"+'<div class="center margin-bottom">'+_l("fileUpload.pleaseDoNotCloseThisDialog")+"</div>",MSG_UPLOAD_FILE_SUCCESS='<h4 class="center">'+'<i class="static-icon static-icon-check i-margin-right"></i>'+_l("fileUpload.importedSuccessfully")+"</h4>",MSG_MARK_AS_DONE='<div class="upload_option_item control-group">'+'<label for="mark_as_done_imported" class="checkbox">'+'<input type="checkbox" id="mark_as_done_imported" value="mark_as_done_imported" />'+_l("fileUpload.markAsDoneImported")+"</label>"+"</div>";function show_upload_translations_dialog(fileType,fileName,extension,actionUrl,note){if(fileType){TYPE_FILE=fileType;FILE_EXTENSION=extension}var $dialog=$("#dummy_dialog");$dialog.dialog({autoOpen:false,resizable:false,bgiframe:true,width:600,buttons:[{text:_l("generic.close"),click:function click(){$(this).dialog("close")}}]}).parent().find(".ui-dialog-buttonset").prepend('<div class="btn file-translations-upload"'+">"+_l("fileUpload.selectFile")+"</div>");var title=fileName?_l("fileUpload.uploadFileTranslations",{file:htmlspecialchars(fileName)}):_l("fileUpload.uploadProjectTranslations");$dialog.dialog("option","title",title);var dialogContent=MSG_UPLOAD_FILE_INIT;if(crowdin.editor.approvingAvailable()||crowdin.editor.isOutOfWorkflowEditorMode()){dialogContent+=MSG_APPROVE_INPUT}if(crowdin.editor.translateHiddenAvailable()){dialogContent+=MSG_TRANSLATE_HIDDEN}if(crowdin.editor.isOutOfWorkflowEditorMode()){dialogContent+=MSG_MARK_AS_DONE}if(note){dialogContent+='<div class="alert alert-info margin-top">'+note+"</div>"}$dialog.html(dialogContent);$dialog.dialog("open");init_upload_translations_button(actionUrl)}function init_upload_translations_button(actionUrl){var getAllowedExtensions=function getAllowedExtensions(){var allowedExtensions=[];if(TYPE_FILE!=="properties_play"){if(!IS_EXTERNAL_PROJECT){allowedExtensions=ALL_FILES_EXTENSIONS[TYPE_FILE]}if(TYPE_FILE==="assets"){allowedExtensions.push(FILE_EXTENSION)}else if(["xliff","xliff2","glossary"].indexOf(TYPE_FILE)===-1&&allowedExtensions.indexOf("xliff")===-1&&allowedExtensions.indexOf("xlf")===-1){allowedExtensions.push("xlf","xliff")}}return allowedExtensions};var handleUploadSubmit=function handleUploadSubmit(id,fileName){var extension=/[.]/.exec(fileName)?/[^.]+$/.exec(fileName.toLowerCase())[0]:"";if(TYPE_FILE==="properties_play"&&!isPlayTypeFile(ALL_FILES_EXTENSIONS,extension)){$.jGrowl(_l("fileManager.invalidFormatUsePlayFrameworkTranslations"));return false}var request_params={};if($("#import_eq_suggestions").is(":checked")){request_params.import_eq_suggestions=1}if((crowdin.editor.approvingAvailable()||crowdin.editor.isOutOfWorkflowEditorMode())&&$("#auto_approve_imported").is(":checked")){request_params.auto_approve_imported=1}if(crowdin.editor.isOutOfWorkflowEditorMode()&&$("#mark_as_done_imported").is(":checked")){request_params.mark_as_done_imported=1}if(crowdin.editor.translateHiddenAvailable()&&$("#translate_hidden").is(":checked")){request_params.translate_hidden=1}if(crowdin.editor){request_params.ws_hash_user_key=crowdin.editor.ws_hash_user_key;if(crowdin.editor.workflow_step.id){request_params.workflow_step_id=crowdin.editor.workflow_step.id}}translationsUploader.setParams(request_params);$("#dummy_dialog").dialog("option","buttons",[{text:_l("generic.close"),click:function click(){$(this).dialog("close")}}]);$("#dummy_dialog").html(MSG_UPLOAD_FILE_PROCESS)};var handleUploadComplete=function handleUploadComplete(id,fileName,response){var getDialogHtml=function getDialogHtml(){var result="";if(response.success){result=MSG_UPLOAD_FILE_SUCCESS;if(!crowdin.editor){result+='<div class="center margin-bottom">'+_l("fileUpload.pleaseReloadToSeeProgressChanges")+"</div>"}if(response.notes){result+='<div class="upload_note"><p>'+response.notes.join("</p><p>")+"</p></div>"}}else{result='<div style="text-align: center; color: #900;">'+(response.msg||_l("error.internalError"))+"</div>"}return result};if(response.success){if(crowdin.editor){crowdin.editor.invoke("clearModels");if(crowdin.editor.modeReviewProofread()){crowdin.phrases_list.disselect_all()}crowdin.user.set_texts_page(1);crowdin.phrases.refresh(crowdin.editor.modeTranslate()?"upload_translations":null)}else{$("#dummy_dialog").dialog("option","buttons",[{text:_l("generic.close"),click:function click(){$(this).dialog("close")}},{text:_l("generic.reload"),click:function click(){crowdin.helpers.url.reload();$(this).dialog("close")}}])}}$("#dummy_dialog").html(getDialogHtml())};var translationsUploader=new qq.FileUploaderBasic({button:$(".file-translations-upload").get(0),action:actionUrl,allowedExtensions:getAllowedExtensions(),sizeLimit:FILESIZE_LIMITS.FILE,multiple:false,onSubmit:function onSubmit(id,fileName){return handleUploadSubmit(id,fileName)},onComplete:function onComplete(id,fileName,response){handleUploadComplete(id,fileName,response)}})}
