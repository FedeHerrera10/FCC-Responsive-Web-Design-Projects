"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var files=function(_CrowdinComponent){_inherits(files,_CrowdinComponent);var _super=_createSuper(files);function files(options){var _this;_classCallCheck(this,files);_this=_super.call(this);_this.is_mac=navigator.platform.toUpperCase().indexOf("MAC")>=0;_this.pointer_events=true;_this.request_number=0;_this.request_pending=false;_this.request_buffer=false;_this.error_occured=false;_this.error_msg=["span",_l("editor.errorLoadingData")," ",["a.ajax-link files-js-reload-action",{href:"#"},_l("generic.retry")]];_this.loader_tpl='<div class="files-js-loader">'+_l("generic.loadingD")+"</div>";_this.filter_template=""+'<div class="filter-list-toolbar">'+'<input type="text" class="no-margin input-medium files-js-filter"/>'+'<a href="#" class="transparent hide clear-filter-query">'+'<i class="static-icon static-icon-squared-cross"></i>'+"</a>"+"</div>";_this.options={no_files_msg:["div.empty-message",_l("generic.nothingToDisplay")],no_files_msg_filter:["div.empty-message",_l("generic.nothingToDisplay")],url:"",params:{},dir:0,autoload:true,autorender:true,container:"",filter_container:"",filter_placeholder:"",open_handler:"dblclick",extra_sort:null,check_response:function check_response(){},item_open:function item_open(){},item_select:function item_select(){},before_render:function before_render(){},items_update:function items_update(){},items_reload:function items_reload(){},items_move:function items_move(){},validate_move:function validate_move(){},data:[],model:[],node_tpl:function node_tpl(){},display_legend:true,storage_key:"",drag:false,closed_by_default:true,smart_search:[],hide_by_default:function hide_by_default(){},show_empty_folders:true,striped:true,selectable:true,singleselect:false,checkboxes:false,tree_padding:30,use_checkboxes:true,select_event_namespace:""};_this.data=[];_this.filter_block="";_this.current_path="";_this.search_query="";_this.folders_state={};_this.react=null;_this.view=null;_this.div=null;_this.select=null;_this.rgx=null;_this.selected_nodes_offset={};_this.clone=null;_this.drop_node=null;_this.open_timeout=null;_this.not_rendered=true;_this.ct={node_directory:0,node_file:1,node_branch:2};var self=_assertThisInitialized(_this);self.pointer_events=function(){var element=document.createElement("x");element.style.cssText="pointer-events:auto";return element.style.pointerEvents==="auto"}();_this.options=$.extend({},_this.options,options);if(Object.keys(_this.options.data).length){_this.data=_this.options.data}_this.getFoldersState();_this.react=createReactClass({displayName:"FilesView",getInitialState:function getInitialState(){return{files:[],dir:0,model:self.options.model}},componentWillUpdate:function componentWillUpdate(){self.options.before_render()},componentDidUpdate:function componentDidUpdate(){self.stripe();self.options.items_update()},componentWillUnmount:function componentWillUnmount(){$(document).off("keydown",self.options.container+" .files-js-container:first")},refresh:function refresh(){this.setState({files:self.sort_files(self.data),dir:self.options.dir,model:self.options.model})},render:function render(){self.loader();self.not_rendered=false;return ReactCompile(["div.files-js-container unselectable clearfix"+(!this.state.files.length?" empty-files":""),this.displayLegend(),this._make_back_directory(),this.displayFiles()])},get_indentation:function get_indentation(level){var max_level=10;var padding=self.options.tree_padding;level=level>max_level?max_level:level;return 30+level*padding},displayLegend:function displayLegend(){if(!self.options.display_legend){return null}var model=this.state.model;var result=["div.files-js-legend"];if(!this.state.files.length){return null}for(var i=model.length-1;i>=0;i--){if(model[i].display===false){continue}var styles={};if(model[i].align){styles["textAlign"]=model[i].align}if(model[i].width){styles["width"]=model[i].width}result.push(["div.files-js-col-legend "+model[i].legendClassName,{style:styles},model[i].title])}result.push(["div",{style:{overflow:"hidden"}},_l("generic.name")]);return result},displayFiles:function displayFiles(){var result=null;if(!self.error_occured){result=this._render_contents(this.state.dir,-1);if(!result){if(self.search_query){result=["div.no-files-msg",self.options.no_files_msg_filter]}else if(!self.options.url||self.request_number){result=["div.no-files-msg",self.options.no_files_msg]}}}else{result=["div.no-files-msg",self.error_msg]}return result},_render_contents:function _render_contents(dir,level,force){var result=[];dir=+dir;level++;for(var i=0,len=this.state.files.length;i<len;i++){var node=this.state.files[i];var node_type=+node.node_type;if(+node.parent_id===dir){if(node_type===self.ct.node_directory||node_type===self.ct.node_branch){var node_el=this._make_directory(node,level,force);node_el&&result.push(node_el)}else if(node_type===self.ct.node_file){var node_el=this._make_file(node,level,force);node_el&&result.push(node_el)}}}return result.length?result:null},_get_node_name_tpl:function _get_node_name_tpl(node_item){var custom_tpl=self.options.node_tpl(node_item);if(custom_tpl)return custom_tpl;var title=node_item.title||"";return["span.node_name",node_item.name,title?["span.muted"," ("+title+")"]:null]},_make_directory:function _make_directory(node_item,level,force){var name=node_item.name;var title=node_item.title?node_item.title:"";var indentation=this.get_indentation(level);var state=self.folders_state["node_"+node_item.id];var saved_state=typeof state!=="undefined";var closed=saved_state?!state:self.options.closed_by_default;if(self.options.hide_by_default(node_item)){return null}if(self.search_query){closed=false}if(self.search_query&&(self.rgx.test(title)||self.rgx.test(name))){force=true}var childs=this._render_contents(node_item.id,level,force);if(!force&&self.search_query&&!childs&&!node_item.editable){return null}if(!childs&&!self.options.show_empty_folders){return null}var dir_name=node_item.editable===true?["input",{type:"text",defaultValue:name,disabled:node_item.id<0}]:this._get_node_name_tpl(node_item);var dir_tag=self.options.checkboxes?"label.checkbox file-name text-overflow":"span.file-name text-overflow";var node_title=["div.title",{key:-1},["span.folder-toggler",{style:{width:indentation+"px",display:childs?"block":"none"}}],[dir_tag,{style:{paddingLeft:indentation+"px"}},self.options.checkboxes?["input",{type:"checkbox",tabIndex:-1}]:null,["span.file_type file_folder"+(+node_item.node_type===self.ct.node_branch?" file_branch":"")],dir_name]];var model_cols=this._get_model_cols(node_item);var node_inner=["div.node-inner",{"data-id":node_item.id},model_cols.length?model_cols.concat([node_title]):node_title];return["div.node node-directory "+(!closed&&childs?"expanded":"collapsed")+(+node_item.node_type===self.ct.node_branch?" node-branch":""),{key:node_item.id,"data-id":node_item.id},node_inner,["div.node-childs",childs]]},_make_file:function _make_file(node_item,level,force){var name=node_item.name;var title=node_item.title?node_item.title:"";var show_file=true;if(self.options.hide_by_default(node_item)){return null}if(self.search_query){if(!(self.rgx.test(title)||self.rgx.test(name))&&!force){show_file=false}for(var i=0,len=self.options.smart_search.length;i<len;i++){var variants=self.options.smart_search[i][0].split(",");for(var j=0,length=variants.length;j<length;j++){if(self.search_query.toLowerCase()===variants[j].toLowerCase().trim()){show_file=self.options.smart_search[i][1](node_item);break}}}}if(!show_file){return null}var file_name=node_item.editable===true?["input",{type:"text",defaultValue:name,disabled:node_item.id<0}]:this._get_node_name_tpl(node_item);var file_tag=self.options.checkboxes?"label.checkbox node_file file-name text-overflow":"span.node_file file-name text-overflow";var node_title=["div.title",{key:-1},[file_tag,{style:{paddingLeft:this.get_indentation(level)+"px"}},self.options.checkboxes?["input",{type:"checkbox",tabIndex:-1}]:null,["span.file_type file_"+node_item.type],file_name]];var model_cols=this._get_model_cols(node_item);var node_inner=["div.node-inner",{"data-id":node_item.id},model_cols.length?model_cols.concat([node_title]):node_title];return["div.node"+(node_item.total_count==0?" node_hidden":""),{key:node_item.id,"data-id":node_item.id},node_inner]},_get_model_cols:function _get_model_cols(node_item){var model=this.state.model;var result=[];for(var i=model.length-1;i>=0;i--){if(model[i].display===false){continue}var styles={};var className=model[i].className||"";if(model[i].align){styles["textAlign"]=model[i].align}if(model[i].width){styles["width"]=model[i].width}var content=typeof model[i].content==="function"?model[i].content(node_item):model[i].content;result.push(["div.files-js-col "+className,{style:styles,key:i},content])}return result},_get_node:function _get_node(id){id=+id;for(var i=0,len=this.state.data.length;i<len;i++){var node=this.state.files[i];if(+node.id===id){return node}}return null},_make_back_directory:function _make_back_directory(){if(this.state.dir===0){return null}var this_dir=this._get_node(this.state.dir);if(!this_dir){return null}var parent_node_id=this_dir.parent_id;return["div#node_"+parent_node_id+".node expanded",{key:this_dir.id,"data-id":this_dir.id},["div.node-inner",["div.title",["span.folder-toggler",{style:{visibility:"hidden",left:this.get_indentation(0)-30+"px"}}],["span.file-name text-overflow",{"data-node":parent_node_id,style:{paddingLeft:this.get_indentation(0)+"px"},title:_l("projectFiles.back")},["span.file_type file_folder"],".."]]]]}});_this.makeGrid();_this.make_filter();if(_this.options.autoload&&_this.options.url){_this.refresh()}return _this}_createClass(files,[{key:"sort_files",value:function sort_files(data){var result=this.sort_by_name(data);if(typeof this.options.extra_sort==="function"){result=this.options.extra_sort(result)}return result}},{key:"sort_by_name",value:function sort_by_name(data){var branches_list=[];var dir_list=[];var files_list=[];for(var i=0,len=data.length;i<len;i++){if(data[i].node_type==="2"){branches_list.push(data[i])}else if(data[i].node_type==="0"){dir_list.push(data[i])}else{files_list.push(data[i])}}var sort_fn=function sort_fn(a,b){function chunkify(t){var tz=new Array;var x=0,y=-1,n=0,i,j;while(i=(j=t.charAt(x++)).charCodeAt(0)){var m=i==46||i>=48&&i<=57;if(m!==n){tz[++y]="";n=m}tz[y]+=j}return tz}var aa=chunkify(a.name.toLowerCase());var bb=chunkify(b.name.toLowerCase());for(var x=0;aa[x]&&bb[x];x++){if(aa[x]!==bb[x]){var c=Number(aa[x]),d=Number(bb[x]);if(c==aa[x]&&d==bb[x]){return c-d}else return aa[x]>bb[x]?1:-1}}return aa.length-bb.length};branches_list.sort(sort_fn);dir_list.sort(sort_fn);files_list.sort(sort_fn);return branches_list.concat(dir_list,files_list)}},{key:"loader",value:function loader(show){if(!this.div){return}var self=this;var loader=$(".files-js-loader",self.div);if(loader.length===0){loader=$(self.loader_tpl)}function fit(){var window_y=window.scrollY;var div_y=self.div.offset().top;loader.css("position",div_y<window_y?"fixed":"absolute")}if(show){loader.appendTo(self.div);fit();$(window).on("scroll.files-js-loader",fit)}else{loader.remove();$(window).off(".files-js-loader")}}},{key:"getFoldersState",value:function getFoldersState(){if(!this.options.storage_key){return}try{if(typeof localStorage[this.options.storage_key]==="string"){this.folders_state=JSON.parse(localStorage[this.options.storage_key])}}catch(e){}}},{key:"saveFoldersState",value:function saveFoldersState(){if(!this.options.storage_key){return}try{localStorage[this.options.storage_key]=JSON.stringify(this.folders_state)}catch(e){}}},{key:"getNode",value:function getNode(id){id=+id;for(var i=0,len=this.data.length;i<len;i++){var node=this.data[i];if(+node.id===id){return node}}return{}}},{key:"getNodesFiltered",value:function getNodesFiltered(method,limit){var nodes=[];var l=0;for(var i=0,len=this.data.length;i<len;i++){var node=this.data[i];if(method(node)){l++;nodes.push(node)}if(l===limit){break}}return nodes}},{key:"get_checked_ids",value:function get_checked_ids(){var self=this;var data=this.data;var result=[];for(var i=0,len=data.length;i<len;i++){if(self.options.hide_by_default(data[i])){continue}var is_folder=+data[i].node_type===self.ct.node_directory||+data[i].node_type===self.ct.node_branch;if(!is_folder&&data[i].checked){result.push(data[i].id)}}return result}},{key:"getNodesByParent",value:function getNodesByParent(method,dir_id){var self=this;var result=[];var path=[];if(typeof method!=="function"){method=function method(){return true}}var data=self.sort_files(self.data);var check_folder=function check_folder(dir){for(var i=0,len=data.length;i<len;i++){var node=data[i];if(+node.parent_id===+dir){path.push(node.name);var is_folder=+node.node_type===self.ct.node_directory||+node.node_type===self.ct.node_branch;if(method(node)){var path_str=path.join("/");if(is_folder){path_str+="/"}result.push($.extend({},node,{path:"/"+path_str}))}if(is_folder){check_folder(node.id)}path.splice(-1,1)}}return result};check_folder(dir_id||self.options.dir);return result}},{key:"getNodeId",value:function getNodeId(element){return $(element).closest(".node").data("id")}},{key:"setNode",value:function setNode(id,node,refresh){id=+id;if(typeof refresh==="undefined"){refresh=true}for(var i=0,len=this.data.length;i<len;i++){if(+this.data[i].id===id){if(!node){this.data.splice(i,1)}else{this.data[i]=$.extend(this.data[i],node)}if(refresh){this.view.refresh()}return}}if(node){this.data.unshift(node);if(refresh){this.view.refresh()}}}},{key:"makeGrid",value:function makeGrid(){var self=this;this.view=ReactDOM.render(React.createElement(this.react),$(this.options.container)[0]);this.div=$(this.options.container).find(".files-js-container:first");this.stripe();this.div.on("click",".folder-toggler",(function(e){self.toggleFolder($(this).closest(".node"));e.stopPropagation()})).on("dblclick mousedown",".folder-toggler",(function(e){$(document).trigger("mousedown");e.stopPropagation()}));this.div.on("click",".files-js-reload-action",(function(e){e.preventDefault();self.refresh()}));if(this.options.selectable){this.select=new select({container:self.options.container+" .files-js-container:first",selector:".node-inner:not(.node.collapsed > .node-childs .node-inner)",open_handler:this.options.open_handler,open_fn:this.options.item_open,select_fn:this.options.item_select,drag_start_fn:function drag_start_fn(){self.files_drag_start()},drag_fn:function drag_fn(x,y){self.files_drag(x,y)},drag_end_fn:function drag_end_fn(){self.files_drag_end()},drag:this.options.drag,smooth_scroll:false,singleselect:this.options.singleselect,use_checkboxes:this.options.use_checkboxes,event_namespace:this.options.select_event_namespace});$(document).on("keydown",this.options.container+" .files-js-container:first",(function(e){if(document.activeElement.nodeName!=="INPUT"&&(e.which===37||e.which===39)){var selected=self.select.get_selected_items();if(selected.length===1){var node=selected.closest(".node");if(node.hasClass("collapsed")&&e.which===39||node.hasClass("expanded")){self.toggleFolder(selected.closest(".node"),e.which===39)}else if(e.which===37){self.select.select(selected.closest(".expanded").children(".node-inner"))}}}}))}}},{key:"files_drag",value:function files_drag(x,y){var startX=this.selected_nodes_offset.left;var startY=this.selected_nodes_offset.top;this.clone.css({left:startX+x+"px",top:startY+y+"px"})}},{key:"files_drag_start",value:function files_drag_start(){$(".files-js-container").mask();var selected=this.select.get_selected_items();this.selected_nodes_offset=selected.offset();if(this.clone){this.clone.remove()}this.clone=this.extract_selected();$("body").append(this.clone.css({top:this.selected_nodes_offset.top,left:this.selected_nodes_offset.left}));this.bind_droppable()}},{key:"files_drag_end",value:function files_drag_end(){var self=this;$(".files-js-container").unmask();this.unbind_droppable();function remove_clone_animate(){self.clone.animate({left:self.selected_nodes_offset.left+"px",top:self.selected_nodes_offset.top+"px"},300,(function(){self.clone.remove()}))}if(this.drop_node===null){remove_clone_animate();return}var parent_id=this.getNodeId(this.drop_node)||this.options.dir;var file_ids=self.get_ids_selected();file_ids=this.options.validate_move(file_ids,parent_id);if(!file_ids.length){remove_clone_animate()}else{this.clone.remove();this.options.items_move(file_ids,parent_id)}}},{key:"bind_droppable",value:function bind_droppable(){var self=this;var prev_target=null;$(document).on("mousemove.files-js-drop",(function(e){var target=e.target;if(prev_target===target){return}var file_ids=self.get_ids_selected();var parent_id=null;if(!self.pointer_events){self.clone.hide();target=document.elementFromPoint(e.clientX,e.clientY);self.clone.show()}clearTimeout(self.open_timeout);prev_target=target;self.div.removeClass("drop-ready").find(".node-directory").removeClass("drop-ready");var node=$(target).closest(".node-directory");self.drop_node=null;if(node.length){if(!node.children(".node-inner.checked").length){parent_id=self.getNodeId(node)||self.options.dir;if(!self.options.validate_move(file_ids,parent_id).length){$("body").addClass("not-allowed-move");return}$("body").removeClass("not-allowed-move");node.addClass("drop-ready");self.drop_node=node;self.open_timeout=setTimeout((function(){self.expandFolder(node)}),700)}}else if($(target).closest(".files-js-container").length){node=self.div;parent_id=self.getNodeId(node)||self.options.dir;if(!self.options.validate_move(file_ids,parent_id).length){return}self.div.addClass("drop-ready");self.drop_node=node}else{$("body").addClass("not-allowed-move")}}))}},{key:"unbind_droppable",value:function unbind_droppable(){$("body").removeClass("not-allowed-move");clearTimeout(this.open_timeout);$(document).off(".files-js-drop");this.div.removeClass("drop-ready").find(".node-directory").removeClass("drop-ready")}},{key:"get_ids_selected",value:function get_ids_selected(){var self=this;var selected_files=this.select.get_selected_items();var file_ids=[];var file_id;for(var i=0,len=selected_files.length;i<len;i++){file_id=self.getNodeId(selected_files[i]);if(file_id<0){continue}file_ids.push(file_id)}return file_ids}},{key:"extract_selected",value:function extract_selected(){var nodes=this.select.get_nodes();var reached_selected=false;var html="";var skipped=0;var empty_space='<div style="height: '+33*skipped+'px;"></div>';var node_html=function node_html(html){var tmp_element=$(html);tmp_element.find(".folder-toggler").remove();tmp_element.find("*").removeAttr("data-reactid");html=tmp_element.html();tmp_element.remove();return'<div class="node-clone">'+html+"</div>"};var node;for(var i=0,len=nodes.length;i<len;i++){node=$(nodes[i]);if(node.hasClass("checked")){reached_selected=true;if(skipped){html+=empty_space}html+=node_html(node.find(".title")[0].outerHTML);skipped=0}else if(reached_selected){skipped++}}return $('<div class="node-clones unselectable">'+html+"</div>")}},{key:"stripe",value:function stripe(){if(this.options.striped){this.div.find(".node-inner:not(.node.collapsed > .node-childs .node-inner)").removeClass("even").filter(":even").addClass("even")}}},{key:"refresh",value:function refresh(reset_filter){var self=this;self.request_number++;var params=self.get_params();reset_filter&&self.reset_filter();self.loader(true);self.request_pending=true;crowdin.ajax.getData(self.options.url,params,(function(response){if(response.request&&response.request!==self.request_number){return}self.request_pending=false;if(self.check_response(response)){self.data=response.data}self.options.items_reload();if(self.options.autorender||self.div.is(":visible")){self.view.refresh()}else{self.not_rendered=true}if(self.request_buffer){self.refresh();self.request_buffer=false}}),null,false,true)}},{key:"get_params",value:function get_params(){var self=this;var params=$.extend({},self.options.params);params.request=self.request_number;var keys=Object.keys(params);for(var i=0,l=keys.length;i<l;i++){if(typeof params[keys[i]]==="function"){params[keys[i]]=params[keys[i]]()}else{params[keys[i]]=params[keys[i]]}}return params}},{key:"check_response",value:function check_response(response){this.error_occured=false;if(!response||!response.data||this.options.check_response(response)===false){this.error_occured=true}return!this.error_occured}},{key:"get_path",value:function get_path(dir_id){var path=[];while(true){if(+dir_id===0){break}var node=this.getNode(dir_id);var node_title=htmlspecialchars(node.name);path.push(node_title);dir_id=node.parent_id}return path.reverse()}},{key:"make_filter",value:function make_filter(){if(this.options.filter_container===""){return}function escape_rgx(str){return str.replace(/[\-\[\]\/\{\}\(\)\+\.\\\^\$\|]/g,"\\$&").replace(/\*/g,".*").replace(/\?/g,".{1}")}var self=this;var rebuild_timeout=0;self.filter_block=$(self.filter_template);var input=self.filter_block.find("input");var clear_btn=self.filter_block.find(".clear-filter-query");input.attr("placeholder",self.options.filter_placeholder);$(self.options.filter_container).empty();self.filter_block.appendTo(self.options.filter_container);input.on("input propertychange",(function(){clearTimeout(rebuild_timeout);rebuild_timeout=setTimeout((function(){self.search_query=input.val();var regexp=escape_rgx(self.search_query);if(/\*|\?/i.test(self.search_query)){regexp="^"+regexp+"$"}self.rgx=new RegExp(regexp,"im");self.view.refresh();clear_btn[input.val()===""?"hide":"show"]()}),350)}));clear_btn.click((function(){$(this).hide();input.val("").focus();self.search_query="";self.rgx=new RegExp(self.search_query,"im");self.view.refresh();return false}))}},{key:"reset_filter",value:function reset_filter(){this.search_query="";this.filter_block.find("input").val("");this.filter_block.find(".clear-filter-query").hide()}},{key:"selectNode",value:function selectNode(id){return this.select.select("[data-id="+id+"]")}},{key:"expandFolder",value:function expandFolder(node){this.toggleFolder(node,true)}},{key:"collapseFolder",value:function collapseFolder(node){this.toggleFolder(node,false)}},{key:"toggleFolder",value:function toggleFolder(node,visible){var $element;if(typeof node==="number"||typeof node==="string"){$element=$(".node[data-id="+node+"]",this.options.container)}else{$element=node}if(typeof visible==="undefined"){visible=$element.hasClass("collapsed")}var dir=$element.data("id");if(!dir){return}$element[!visible?"addClass":"removeClass"]("collapsed")[visible?"addClass":"removeClass"]("expanded");if(!visible&&this.options.selectable){this.select.item_disselect($element.find(".node-childs .node-inner"));this.select.update_selection()}this.stripe();this.folders_state["node_"+dir]=visible;this.saveFoldersState()}}]);return files}(CrowdinComponent);function files_focus(eq){var items_container=$(".files-js-container:visible").eq(eq?eq:0);if(items_container.length){var x=window.scrollX||window.pageXOffset,y=window.scrollY||window.pageYOffset;items_container.focus();window.scrollTo(x,y)}}
