"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var HeaderView=function(_React$Component){_inherits(HeaderView,_React$Component);var _super=_createSuper(HeaderView);function HeaderView(props){var _this;_classCallCheck(this,HeaderView);_this=_super.call(this,props);_this.state={messagesCount:crowdin.user.unread_messages_count,notificationsCount:crowdin.user.unread_notifications_count};return _this}_createClass(HeaderView,[{key:"componentDidMount",value:function componentDidMount(){this.bindEvents()}},{key:"render",value:function render(){var _this2=this;if(crowdin.editor.jipt_mode){return null}var resultTemplate=["div.navbar-inner editor-navbar",["ul.nav editor-menu",{id:"editor-menu"},["li",["a",{id:"main-menu-toggler",tabIndex:-1,role:"button",href:"#",title:_l("editor.focusMenuHotkey",{hotkey:crowdin.hotkeys.get(crowdin.hotkeys.FOCUS_MENU_KEY)}),ref:function ref(node){_this2.mainMenuBtn=node}},["i.static-icon-menu"]]]],["div.pull-right clearfix",this.getEditorHeaderButtonsTpl(),this.getEditorHeaderIconsTpl(),this.props.isPwa&&["a.btn btn-icon",{style:{marginLeft:"5"},title:_l("editor.quitEditorTitle"),href:crowdin.editor.task.id?crowdin.editor.project.url+"/tasks":crowdin.helpers.url.getProjectLanguageUrl()},["i.static-icon-power"]]],["div#warning-connection.pull-right "+(!crowdin.editor.onlineStatus?"":"hidden"),{style:{padding:"4px"},title:_l("editor.offline")},["i.static-icon-warning-color"]],["div",{style:{display:"flex",justifyContent:"left"}},this.getEditorInfoToolbar()]];return ReactCompile(resultTemplate)}},{key:"handleMainMenuBtn",value:function handleMainMenuBtn(e){if(e.which===27){if(crowdin.editor.modeTranslate()){crowdin.translation.area.focus()}else if(crowdin.editor.modeReviewProofread()){document.getElementById("phrases").focus()}else if(crowdin.editor.modeAssets()){document.getElementById("suggestions-wrapper").focus()}}else if(e.which===13){e.target.click()}else{e.target.blur()}}},{key:"getFileMenuTpl",value:function getFileMenuTpl(){var file_type="";var node_type="";if(!crowdin.editor.file||IS_STRINGS_BASED_PROJECT&&!IS_EXTERNAL_PROJECT){return null}if(crowdin.editor.file.node_type!==""){node_type=+crowdin.editor.file.node_type}switch(node_type){case crowdin.editor.file_nodes.file:file_type="file_"+crowdin.editor.file.type;break;case crowdin.editor.file_nodes.branch:file_type="file_folder file_branch";break;case crowdin.editor.file_nodes.directory:file_type="file_folder";break}return["a.btn mdc-button open-file-menu",{id:"file-menu-item",role:"button",href:"#",tabIndex:-1,onClick:function onClick(e){e.preventDefault();if(crowdin.plugins.open_file){crowdin.plugins.open_file.run()}}},["div.text-overflow file-name-wrapper",crowdin.editor.isAllFilesSelected()?null:["span.file_type "+file_type],["span.file-name",crowdin.editor.isAllFilesSelected()?_l("editor.allStrings"):crowdin.editor.file.name]]]}},{key:"getLanguageMenuTpl",value:function getLanguageMenuTpl(){var _crowdin$helpers$main=crowdin.helpers.main_menu,showMenu=_crowdin$helpers$main.showMenu,LANGUAGE_MENU=_crowdin$helpers$main.LANGUAGE_MENU;if(!crowdin.editor.target_language||crowdin.editor.modeReview()||crowdin.editor.task.id){return null}return["a.btn mdc-button open-language-menu",{role:"button",href:"#",tabIndex:-1,onClick:function onClick(e){e.preventDefault();showMenu(LANGUAGE_MENU);setTimeout((function(){$("#menu-filter-languages").focus()}),0)}},["span.language-name-wrapper text-overflow",crowdin.editor.target_language.name]]}},{key:"getWorkflowMenuTpl",value:function getWorkflowMenuTpl(){var _crowdin$helpers$main2=crowdin.helpers.main_menu,showMenu=_crowdin$helpers$main2.showMenu,FILE_MENU=_crowdin$helpers$main2.FILE_MENU,WORKFLOW_MENU=_crowdin$helpers$main2.WORKFLOW_MENU;if(!crowdin.editor.project.has_advanced_workflow||crowdin.editor.isOutOfWorkflowEditorMode()||crowdin.editor.task.id){return null}return["a.btn mdc-button open-workflow-menu",{role:"button",href:"#",tabIndex:-1,onClick:function onClick(e){e.preventDefault();showMenu(crowdin.editor.modeReview()?FILE_MENU:WORKFLOW_MENU)}},["span.workflow-name-wrapper text-overflow",crowdin.editor.workflow_step.title]]}},{key:"getTaskMenuTpl",value:function getTaskMenuTpl(){var _crowdin$helpers$main3=crowdin.helpers.main_menu,showMenu=_crowdin$helpers$main3.showMenu,FILE_MENU=_crowdin$helpers$main3.FILE_MENU;if(!crowdin.editor.task.id){return null}return["a.btn mdc-button",{id:"task-info",role:"button",href:"#",tabIndex:-1,onClick:function onClick(e){e.preventDefault();showMenu(FILE_MENU)}},["div.text-overflow task-title-wrapper",crowdin.editor.task.title]]}},{key:"getEditorHeaderButtonsTpl",value:function getEditorHeaderButtonsTpl(){var result=["div.btn-toolbar no-margin pull-left"];result.push(["div.btn-toolbar pull-left",{style:{margin:"0 7px 0"},id:"panes-controller"},!crowdin.editor.modeReviewProofread()?["button.btn btn-icon pane-toggler pane-toggler-left",{tabIndex:"-1"},["i.static-icon-pane-opened-left"]]:null,["button.btn btn-icon pane-toggler pane-toggler-right",{tabIndex:"-1"},["i.static-icon-pane-opened-right"]]]);if(!IS_MOBILE){result.push(["button.btn btn-icon",{id:"action_editor_hotkeys",title:_l("editor.keyboardShortcutsHotkey",{hotkey:crowdin.hotkeys.getLabel(crowdin.hotkeys.KEYBOARD_SHORTCUTS_KEY)}),tabIndex:-1},["i.static-icon-keyboard"]])}if(!crowdin.editor.modeAssets()){result.push(["button.btn btn-icon",{id:"action_editor_settings",title:_l("editor.editorSettings"),tabIndex:-1},["i.static-icon-cog"]])}return result}},{key:"getEditorHeaderIconsTpl",value:function getEditorHeaderIconsTpl(){var result=["ul.nav no-margin"];var logoutQuery=$.param({domain:crowdin.editor.organization.domain||"",cname:crowdin.editor.organization.cname.domain||""});var logoutUrl=getCookie("jwt")?AUTH_HOST+"/logout?"+logoutQuery:"/backend/user/logout";var hasNotifications=!!this.state.notificationsCount;var hasMessages=!!this.state.messagesCount;var notificationsCount=this.state.notificationsCount>99?"99+":this.state.notificationsCount;var messagesCount=this.state.messagesCount>99?"99+":this.state.messagesCount;var settingsUrl=IS_ENTERPRISE?"/u/user_settings":"/settings";var notificationsUrl="".concat(IS_ENTERPRISE?"/u/user":"","/notifications");var messagesUrl="".concat(IS_ENTERPRISE?"/u":"","/messages");result.push(["li.dropdown pull-right",["a.dropdown-toggle text-overflow"+(hasMessages||hasNotifications?" has-alert":""),{id:"head-profile-link",href:IS_ENTERPRISE?"/u/":"/profile",title:crowdin.user.login,"data-toggle":"dropdown"},["img",{src:crowdin.user.avatar_url,style:{width:"28px",height:"28px"}}]],!IS_MOBILE?["ul.dropdown-menu",["li",["a.clearfix",{target:"_blank",href:IS_ENTERPRISE?"/u/":"/profile",tabIndex:-1},["span",["span",crowdin.user.name],crowdin.user.name!==crowdin.user.login?["br"]:null,crowdin.user.name!==crowdin.user.login?["span.text-small muted",crowdin.user.login]:null]]],["li.divider"],["li",["a",{href:notificationsUrl,target:"_blank"},_l("editor.notifications"),hasNotifications?["span.badge badge-info s-margin-left",notificationsCount]:null]],["li",["a",{href:messagesUrl,target:"_blank"},_l("editor.messages"),hasMessages?["span.badge badge-info s-margin-left",messagesCount]:null]],["li",["a",{href:settingsUrl,target:"_blank",tabIndex:-1},_l("editor.profileSettings")]],["li",["a",{id:"logout_button",href:logoutUrl,tabIndex:-1},_l("generic.logOut")]]]:null]);return result}},{key:"getEditorInfoToolbar",value:function getEditorInfoToolbar(){var chevronIconTpl=["i.static-icon-chevron-right",{style:{verticalAlign:"top",margin:"5px 0px",opacity:"0.2"}}];var languageMenu=this.getLanguageMenuTpl();var taskMenu=this.getTaskMenuTpl();var fileMenu=this.getFileMenuTpl();var workflowMenu=this.getWorkflowMenuTpl();var infoToolbarId=workflowMenu?"file-language-workflow-info":"file-language-info";return["div.btn-toolbar no-margin",{id:infoToolbarId},languageMenu,taskMenu,languageMenu?chevronIconTpl:null,fileMenu,workflowMenu?chevronIconTpl:null,workflowMenu]}},{key:"bindEvents",value:function bindEvents(){var _this3=this;$("#warning-connection").tooltip({animation:false,placement:"bottom",delay:100,container:"body"});this.mainMenuBtn&&this.mainMenuBtn.addEventListener("keydown",this.handleMainMenuBtn,false);window.addEventListener("online",(function(){crowdin.editor.onlineStatus=true;crowdin.editor.view.setState({updatePhrases:false})}));window.addEventListener("offline",(function(){crowdin.editor.onlineStatus=false;crowdin.editor.view.setState({updatePhrases:false})}));crowdin.editor.on("upcomingNotifications",(function(data){var mail=data.mail,notification=data.notification;_this3.setState({messagesCount:mail,notificationsCount:notification},(function(){crowdin.user.unread_messages_count=mail;crowdin.user.unread_notifications_count=notification}))}))}}]);return HeaderView}(React.Component);
