"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var LanguageMenuTab=function(_React$Component){_inherits(LanguageMenuTab,_React$Component);var _super=_createSuper(LanguageMenuTab);function LanguageMenuTab(props){var _this;_classCallCheck(this,LanguageMenuTab);_this=_super.call(this,props);_this.state={searchText:"",filterLanguages:""};_this.availableItems=[];_this.clearSearch=_this.clearSearch.bind(_assertThisInitialized(_this));_this.handleFilterLanguages=debounce((function(searchText){_this.setState({filterLanguages:searchText});crowdin.editor.view.setState({updatePhrases:false})}),500);return _this}_createClass(LanguageMenuTab,[{key:"componentDidMount",value:function componentDidMount(){this.list.tabIndex=0;this.list.focus({preventScroll:true});this.input.focus()}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){if(!prevProps.inFocus&&this.props.inFocus){this.input.tabIndex=0;this.input.focus()}}},{key:"onChangeInput",value:function onChangeInput(event){this.setState({searchText:event.target.value});this.handleFilterLanguages(event.target.value)}},{key:"clearSearch",value:function clearSearch(){this.setState({searchText:"",filterLanguages:""});this.input.focus()}},{key:"_openInSelfWindow",value:function _openInSelfWindow(e){return!(e.which===2||e.metaKey||e.ctrlKey)}},{key:"onLanguageChange",value:function onLanguageChange(event,languageId){this.props.handleCloseMenu();if(this._openInSelfWindow(event)){crowdin.editor.updateLanguage(languageId,true);event.preventDefault()}}},{key:"allowedLanguagesOnStepLabel",value:function allowedLanguagesOnStepLabel(language){if(crowdin.editor.project.has_advanced_workflow&&crowdin.editor.workflow_step.id){for(var i in crowdin.editor.workflow_step.languages){if(crowdin.editor.workflow_step.languages[i].id==language.id){return null}}return["span.label label-disabled pull-right",{style:{verticalAlign:"middle"},title:_l("languagesDialog.languageTitle",{step:crowdin.editor.workflow_step.title})},"N/A"]}return null}},{key:"getLanguageErrorMessageTpl",value:function getLanguageErrorMessageTpl(){var _crowdin$editor=crowdin.editor,targetLanguage=_crowdin$editor.target_language,outOfScopeTargetLanguage=_crowdin$editor.out_of_scope_target_lang,outOfScopeWorkflowStep=_crowdin$editor.out_of_scope_workflow_step,workflowStep=_crowdin$editor.workflow_step,project=_crowdin$editor.project;if(targetLanguage){return null}var message="";if(crowdin.helpers.url.getEditorInfo().language.toString().length===0){message=_l("languagesDialog.targetLanguageIsNotSelected")}else{if(outOfScopeTargetLanguage){if(project.has_advanced_workflow){var stepTitle=outOfScopeWorkflowStep&&outOfScopeWorkflowStep.title||workflowStep.title;message=!INIT_MANAGERS.length?_l("languagesDialog.stepOutOfLanguageScopeOwner",{language:outOfScopeTargetLanguage.name,step:stepTitle}):_l("languagesDialog.stepOutOfLanguageScope",{className:"alert-link",language:outOfScopeTargetLanguage.name,step:stepTitle,url:"javascript:crowdin.plugins.contact_manager.run();"})}else{message=!INIT_MANAGERS.length?_l("languagesDialog.targetLangOutOfProjectScopeOwner",{language:outOfScopeTargetLanguage.name}):_l("languagesDialog.targetLangOutOfProjectScope",{language:outOfScopeTargetLanguage.name,className:"alert-link",url:"javascript:crowdin.plugins.contact_manager.run();"})}}else{message=!INIT_MANAGERS.length?_l("languagesDialog.targetLangIsIncorrectOwner"):_l("languagesDialog.targetLangIsIncorrect",{className:"alert-link",url:"javascript:crowdin.plugins.contact_manager.run();"})}}return["div.alert",{innerHTML:message}]}},{key:"render",value:function render(){var _this2=this;var _this$state=this.state,searchText=_this$state.searchText,filterLanguages=_this$state.filterLanguages;var target_language_id=crowdin.editor.target_language&&crowdin.editor.target_language.id;var allowedTargetLanguages=crowdin.editor.workflow_step.allowed_languages||crowdin.editor.project.target_languages;allowedTargetLanguages.sort((function(languageA,languageB){if(languageA.preferred&&languageB.preferred){return languageA.name.localeCompare(languageB.name)}if(languageA.preferred&&!languageB.preferred){return-1}if(!languageA.preferred&&!languageB.preferred){return languageA.name.localeCompare(languageB.name)}return 1}));if(!target_language_id&&crowdin.editor.out_of_scope_target_lang){target_language_id=crowdin.editor.out_of_scope_target_lang.id}this.availableItems=[];var preferredLanguages=allowedTargetLanguages.filter((function(languageData){return!(+languageData.is_review||filterLanguages&&languageData.name.toLowerCase().indexOf(filterLanguages.toLowerCase())===-1)&&!(crowdin.editor.task.id&&+crowdin.editor.task.language_id!==+languageData.id)&&languageData.preferred}));if(preferredLanguages.length&&!_.find(allowedTargetLanguages,{divider:true})){allowedTargetLanguages.splice(preferredLanguages.length,0,{name:"",divider:true,disabled:true})}allowedTargetLanguages.filter((function(languageData){return!(+languageData.is_review||filterLanguages&&languageData.name.toLowerCase().indexOf(filterLanguages.toLowerCase())===-1)&&!(crowdin.editor.task.id&&+crowdin.editor.task.language_id!==+languageData.id)})).forEach((function(item,index){!item.disabled&&_this2.availableItems.push(index)}));var languages=allowedTargetLanguages.filter((function(languageData){return!(+languageData.is_review||filterLanguages&&languageData.name.toLowerCase().indexOf(filterLanguages.toLowerCase())===-1)&&!(crowdin.editor.task.id&&+crowdin.editor.task.language_id!==+languageData.id)})).map((function(language,index){var selected=_this2.availableItems[_this2.props.selectedAvailableIndex]===index;var classNames="language "+(selected?" selected ":"")+(+language.id===+target_language_id?" checked":"");if(language.divider){return["li.divider",{key:"divider"}]}return["li",{key:language.id,className:classNames,onMouseEnter:function onMouseEnter(e){var selectedInd=_this2.availableItems.indexOf(index)>=0?_this2.availableItems.indexOf(index):null;_this2.props.itemOnHover(e,selectedInd)},onMouseLeave:function onMouseLeave(e){return _this2.props.itemOnHover(e)}},["a.translation-table-language-link text-overflow",{onClick:function onClick(e){return _this2.onLanguageChange(e,language.id)},href:crowdin.helpers.url.buildEditorPath({language_id:language.internal_code})},language.name,_this2.allowedLanguagesOnStepLabel(language)]]}));if(!languages.length){languages.push(["li.muted",{key:"no-langauges",style:{padding:"7px 5px"}},["span",_l("editor.noLanguagesFound")]])}var modalForm=["div.content",{ref:function ref(list){return _this2.list=list}},["h3",_l("generic.language")],this.getLanguageErrorMessageTpl(),["div.input-search-string "+(filterLanguages?"has-text":""),["input#menu-filter-languages.input-block-level no-margin",{type:"text",placeholder:_l("generic.filterLanguages"),onChange:function onChange(e){return _this2.onChangeInput(e)},onKeyDown:function onKeyDown(e){_this2.props.subMenuHandleKey(e,languages,_this2,true)},value:searchText,ref:function ref(input){return _this2.input=input}}],["button.input-clear",{tabIndex:"-1",onClick:this.clearSearch}]],["ul.nav nav-list margin-bottom",languages]];return ReactCompile(modalForm)}}]);return LanguageMenuTab}(React.Component);
