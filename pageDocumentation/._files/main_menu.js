"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var MenuView=function(_React$Component){_inherits(MenuView,_React$Component);var _super=_createSuper(MenuView);function MenuView(props){var _this;_classCallCheck(this,MenuView);_this=_super.call(this,props);_this.filterLanguages="";_this.keyboardKeys={UP:38,TAB:9,DOWN:40,LEFT:37,ENTER:13,RIGHT:39,ESCAPE:27};_this.state=_this.getInitialState();_this.closeMenu=_this.closeMenu.bind(_assertThisInitialized(_this));_this.handleKey=_this.handleKey.bind(_assertThisInitialized(_this));_this.tabItemOnHover=_this.tabItemOnHover.bind(_assertThisInitialized(_this));_this.subMenuHandleKey=_this.subMenuHandleKey.bind(_assertThisInitialized(_this));return _this}_createClass(MenuView,[{key:"getInitialState",value:function getInitialState(){return{shownFullText:false,selectedIndex:crowdin.helpers.main_menu.FILE_MENU,activeIndex:crowdin.helpers.main_menu.FILE_MENU,inFocus:false,tabSelectedIndex:0,tabInFocus:true}}},{key:"componentDidMount",value:function componentDidMount(){crowdin.editor.mainMenuView=this;this.bindEvents()}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps,prevState){var _this2=this;if(!prevState.inFocus&&this.state.inFocus){setTimeout((function(){_this2.listRef.tabIndex=0;_this2.listRef.focus()}),0)}}},{key:"itemOnHover",value:function itemOnHover(e){var index=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;this.setState({selectedIndex:index})}},{key:"getValueByIndex",value:function getValueByIndex(filteredItems,selectedIndex){var selected=filteredItems.filter((function(item,index){return index===selectedIndex})).pop();return selected.index}},{key:"getIndexByValue",value:function getIndexByValue(filteredItems,val){return filteredItems.map((function(o){return o.index})).indexOf(val)}},{key:"triggerClickOnLink",value:function triggerClickOnLink(listOfLi,callBack){var selectedItem;var container=listOfLi.classList.contains("nav")?listOfLi:listOfLi.querySelectorAll(".nav");var arrOfLi=[];if(container.children){arrOfLi=[].slice.call(container.children,0)}else{container.forEach((function(list){var listArray=[].slice.call(list.children,0);arrOfLi=arrOfLi.concat(listArray)}))}selectedItem=arrOfLi.filter((function(item){return item.classList.contains("selected")})).pop();if((selectedItem||{}).children){var selectedItemChildrenArr=[].slice.call(selectedItem.children,0);var selectedItemLink=selectedItemChildrenArr.filter((function(item){return item.tagName.toLowerCase()==="a"})).pop();selectedItemLink.click();callBack&&callBack()}}},{key:"handleKey",value:function handleKey(e,filteredItems){var _this3=this;var liLength=filteredItems.length;var _this$keyboardKeys=this.keyboardKeys,UP=_this$keyboardKeys.UP,TAB=_this$keyboardKeys.TAB,DOWN=_this$keyboardKeys.DOWN,ENTER=_this$keyboardKeys.ENTER,RIGHT=_this$keyboardKeys.RIGHT,ESCAPE=_this$keyboardKeys.ESCAPE;switch(e.which){case ESCAPE:this.closeMenu();break;case UP:if(this.state.inFocus){if(this.state.selectedIndex&&this.getIndexByValue(filteredItems,this.state.selectedIndex)>0){this.setState((function(prevState){return{selectedIndex:_this3.getValueByIndex(filteredItems,_this3.getIndexByValue(filteredItems,prevState.selectedIndex)-1)}}))}else{this.setState({selectedIndex:this.getValueByIndex(filteredItems,liLength-1)})}}break;case TAB:case DOWN:if(this.state.inFocus){e.preventDefault();if(!this.state.selectedIndex||this.state.selectedIndex===this.getValueByIndex(filteredItems,liLength-1)){this.setState({selectedIndex:this.getValueByIndex(filteredItems,0)})}else if(this.getIndexByValue(filteredItems,this.state.selectedIndex)<liLength-1){this.setState((function(prevState){return{selectedIndex:_this3.getValueByIndex(filteredItems,_this3.getIndexByValue(filteredItems,prevState.selectedIndex)+1)}}))}else{this.setState({selectedIndex:this.getValueByIndex(filteredItems,liLength-1)})}}break;case RIGHT:if(this.state.inFocus){if(this.state.selectedIndex!==crowdin.helpers.main_menu.CLOSE_MENU&&this.state.selectedIndex!==crowdin.helpers.main_menu.QUIT_MENU){this.setState({inFocus:false,tabInFocus:true,activeIndex:this.getValueByIndex(filteredItems,this.getIndexByValue(filteredItems,this.state.selectedIndex)),tabSelectedIndex:0})}}break;case ENTER:if(this.state.inFocus){this.setState({inFocus:false,tabInFocus:true},(function(){if(_this3.state.selectedIndex!==crowdin.helpers.main_menu.CLOSE_MENU&&_this3.state.selectedIndex!==crowdin.helpers.main_menu.QUIT_MENU){_this3.setState({activeIndex:_this3.getValueByIndex(filteredItems,_this3.getIndexByValue(filteredItems,_this3.state.selectedIndex)),tabSelectedIndex:0})}else{_this3.triggerClickOnLink(_this3.listRef)}}))}break}}},{key:"renderItem",value:function renderItem(item,index){var _this4=this;var classNames="item"+(item.index===this.state.activeIndex?" active":"")+(item.index===this.state.selectedIndex?" selected":"");return["li",{onMouseEnter:function onMouseEnter(e){return _this4.itemOnHover(e,item.index)},onMouseLeave:function onMouseLeave(e){return _this4.itemOnHover(e)},onClick:function onClick(){if(item.index===crowdin.helpers.main_menu.QUIT_MENU){_this4.setState((function(prevState){return{inFocus:false,tabInFocus:true,activeIndex:prevState.activeIndex,tabSelectedIndex:prevState.tabSelectedIndex}}))}else if(item.index!==crowdin.helpers.main_menu.CLOSE_MENU&&_this4.state.activeIndex!==item.index){_this4.setState({inFocus:false,tabInFocus:true,activeIndex:item.index,tabSelectedIndex:0})}},key:index,className:classNames},item.children]}},{key:"bindEvents",value:function bindEvents(){var _this5=this;$("#main-menu-toggler").click((function(e){crowdin.editor.layout.showMenu();e.preventDefault()}));$("#main_menu_mask").click((function(){_this5.closeMenu()}))}},{key:"tabItemOnHover",value:function tabItemOnHover(e){var index=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;this.setState({tabInFocus:true,tabSelectedIndex:index})}},{key:"subMenuHandleKey",value:function subMenuHandleKey(e,filteredItems,container){var _this6=this;var leaveInFocus=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var availableSubItems=container.availableItems;var lastIndex=availableSubItems.length-1;var _this$keyboardKeys2=this.keyboardKeys,UP=_this$keyboardKeys2.UP,TAB=_this$keyboardKeys2.TAB,DOWN=_this$keyboardKeys2.DOWN,LEFT=_this$keyboardKeys2.LEFT,ENTER=_this$keyboardKeys2.ENTER,ESCAPE=_this$keyboardKeys2.ESCAPE;switch(e.which){case ESCAPE:this.closeMenu();break;case UP:if(this.state.tabInFocus){if(this.state.tabSelectedIndex!==null&&availableSubItems[this.state.tabSelectedIndex-1]!==undefined){this.setState({tabSelectedIndex:this.state.tabSelectedIndex-1})}else{this.setState({tabSelectedIndex:lastIndex})}}break;case TAB:case DOWN:if(this.state.tabInFocus){e.preventDefault();if(this.state.tabSelectedIndex!==null&&availableSubItems[this.state.tabSelectedIndex+1]!==undefined){this.setState({tabSelectedIndex:this.state.tabSelectedIndex+1})}else{this.setState({tabSelectedIndex:0})}}break;case ENTER:if(this.state.tabInFocus){if(this.state.tabSelectedIndex===null){this.setState({tabSelectedIndex:0})}else{this.setState({tabInFocus:leaveInFocus||false},(function(){_this6.triggerClickOnLink(container.list,_this6.closeMenu)}))}}break;case LEFT:if(this.state.tabInFocus){this.setState({tabInFocus:false,tabSelectedIndex:null},(function(){_this6.setState({inFocus:true,selectedIndex:_this6.state.activeIndex})}))}break}}},{key:"closeMenu",value:function closeMenu(){var editor=crowdin.editor;if(editor.file&&editor.target_language&&editor.isValidWorkflowStep()){this.setState({shownFullText:false,selectedIndex:crowdin.helpers.main_menu.FILE_MENU,activeIndex:crowdin.helpers.main_menu.FILE_MENU,tabSelectedIndex:0,tabInFocus:true,inFocus:false},(function(){crowdin.editor.layout.hideMenu()}))}}},{key:"render",value:function render(){var _this7=this;var item_available=Boolean(crowdin.editor.file&&crowdin.editor.target_language);var menuItems=[{index:"close",item_available:item_available,children:["a",{onClick:this.closeMenu},["i.static-icon-clear"],["span.text",_l("generic.close")]]},{index:crowdin.helpers.main_menu.FILE_MENU,item_available:item_available,children:["a",{href:"#file-menu-content","data-toggle":"tab"},["i."+(crowdin.editor.task.id?"static-icon-task":"static-icon-file")],["span.text",crowdin.editor.task.id?_l("generic.task"):_l("generic.file")]]},{index:crowdin.helpers.main_menu.LANGUAGE_MENU,item_available:!(crowdin.editor.task.id&&crowdin.helpers.url.getEditorInfo().language.toString().length||crowdin.editor.modeReview()),children:["a#language-menu-link",{href:"#language-menu-content","data-toggle":"tab"},["i.static-icon-web"],["span.text",_l("generic.language")]]},{index:crowdin.helpers.main_menu.WORKFLOW_MENU,item_available:!(!crowdin.editor.project.has_advanced_workflow||crowdin.editor.task.id||!_.size(crowdin.editor.workflow_steps)||!crowdin.editor.target_language&&!crowdin.editor.out_of_scope_target_lang),children:["a",{href:"#workflow-menu-content","data-toggle":"tab"},["i.static-icon-workflow"],["span.text",_l("generic.workflow")]]},{index:crowdin.helpers.main_menu.PROJECT_MENU,item_available:item_available,children:["a",{href:"#project-menu-content","data-toggle":"tab"},["i.static-icon-inbox"],["span.text",_l("generic.project")]]},{index:crowdin.helpers.main_menu.VIEW_MENU,item_available:crowdin.editor.modeTranslateProofread()&&item_available,children:["a",{href:"#view-menu-content","data-toggle":"tab"},["i.static-icon-view"],["span.text",_l("generic.view")]]},{index:crowdin.helpers.main_menu.HELP_MENU,item_available:(crowdin.editor.modeTranslateProofread()||crowdin.editor.modeReview())&&item_available,children:["a",{href:"#help-menu-content","data-toggle":"tab"},["i.static-icon-circled-help"],["span.text",_l("generic.help")]]},{index:crowdin.helpers.main_menu.QUIT_MENU,item_available:true,children:["a",{href:crowdin.editor.task.id?crowdin.editor.project.url+"/tasks":crowdin.helpers.url.getProjectLanguageUrl()},["i.static-icon-power"],["span.text",_l("editor.quitEditorTitle")]]}];var filteredItems=menuItems.filter((function(item){return!!item.item_available}));var menuItemsRendered=filteredItems.map((function(item,index){return _this7.renderItem(item,index)}));var menuTabs=[{index:crowdin.helpers.main_menu.FILE_MENU,children:["div#file-menu-content",{className:this.state.activeIndex===crowdin.helpers.main_menu.FILE_MENU?"tab-pane active":"tab-pane"},[FileMenuTab,{selectedAvailableIndex:this.state.tabSelectedIndex,inFocus:this.state.tabInFocus,itemOnHover:this.tabItemOnHover,subMenuHandleKey:this.subMenuHandleKey,handleCloseMenu:this.closeMenu}]]},{index:crowdin.helpers.main_menu.LANGUAGE_MENU,children:["div#language-menu-content",{className:this.state.activeIndex===crowdin.helpers.main_menu.LANGUAGE_MENU?"tab-pane active":"tab-pane"},[LanguageMenuTab,{selectedAvailableIndex:this.state.tabSelectedIndex,inFocus:this.state.tabInFocus,itemOnHover:this.tabItemOnHover,subMenuHandleKey:this.subMenuHandleKey,handleCloseMenu:this.closeMenu}]]},{index:crowdin.helpers.main_menu.WORKFLOW_MENU,children:["div#workflow-menu-content",{className:this.state.activeIndex===crowdin.helpers.main_menu.WORKFLOW_MENU?"tab-pane active":"tab-pane"},[WorkflowMenuTab,{selectedAvailableIndex:this.state.tabSelectedIndex,inFocus:this.state.tabInFocus,itemOnHover:this.tabItemOnHover,subMenuHandleKey:this.subMenuHandleKey}]]},{index:crowdin.helpers.main_menu.PROJECT_MENU,children:["div#project-menu-content",{className:this.state.activeIndex===crowdin.helpers.main_menu.PROJECT_MENU?"tab-pane active":"tab-pane"},[ProjectMenuTab,{selectedAvailableIndex:this.state.tabSelectedIndex,inFocus:this.state.tabInFocus,itemOnHover:this.tabItemOnHover,subMenuHandleKey:this.subMenuHandleKey,languageActivityURL:crowdin.helpers.url.getActivityUrl(),projectLanguageUrl:crowdin.helpers.url.getProjectLanguageUrl(),handleCloseMenu:this.closeMenu}]]},{index:crowdin.helpers.main_menu.VIEW_MENU,children:["div#view-menu-content",{className:this.state.activeIndex===crowdin.helpers.main_menu.VIEW_MENU?"tab-pane active":"tab-pane"},[ViewMenuTab,{selectedAvailableIndex:this.state.tabSelectedIndex,inFocus:this.state.tabInFocus,itemOnHover:this.tabItemOnHover,subMenuHandleKey:this.subMenuHandleKey}]]},{index:crowdin.helpers.main_menu.HELP_MENU,children:["div#help-menu-content",{className:this.state.activeIndex===crowdin.helpers.main_menu.HELP_MENU?"tab-pane active":"tab-pane"},[HelpMenuTab,{selectedAvailableIndex:this.state.tabSelectedIndex,inFocus:this.state.tabInFocus,itemOnHover:this.tabItemOnHover,subMenuHandleKey:this.subMenuHandleKey,handleCloseMenu:this.closeMenu,openOnBoarding:this.props.openOnBoarding}]]}];var selectedTab=menuTabs.filter((function(tab){return tab.index===_this7.state.activeIndex})).pop();return ReactCompile(["div.clearfix",{style:{height:"100%"}},["ul.nav nav-pills nav-stacked pull-left",{tabIndex:this.state.inFocus?0:-1,ref:function ref(el){return _this7.listRef=el},onKeyDown:function onKeyDown(e){return _this7.handleKey(e,filteredItems)},onMouseEnter:function onMouseEnter(e){return _this7.setState({inFocus:true,tabInFocus:false,tabSelectedIndex:null})}},menuItemsRendered],["div.tab-content",{tabIndex:this.state.tabInFocus?0:-1,onClick:function onClick(){_this7.setState({inFocus:false,tabInFocus:true})},style:{height:"100%"},onMouseEnter:function onMouseEnter(e){return _this7.setState({tabInFocus:true,inFocus:false,selectedIndex:null})}},selectedTab?selectedTab.children:null]])}}]);return MenuView}(React.Component);
