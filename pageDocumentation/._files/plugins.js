"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var crowdin_plugin=function(){_createClass(crowdin_plugin,[{key:"disable_plugin",value:function disable_plugin(){}}]);function crowdin_plugin(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$buttonId=_ref.buttonId,buttonId=_ref$buttonId===void 0?null:_ref$buttonId,_ref$hotkey=_ref.hotkey,hotkey=_ref$hotkey===void 0?null:_ref$hotkey,_ref$trigger=_ref.trigger,trigger=_ref$trigger===void 0?false:_ref$trigger,_ref$configurationKey=_ref.configurationKey,configurationKey=_ref$configurationKey===void 0?null:_ref$configurationKey,_ref$dynamicElements=_ref.dynamicElements,dynamicElements=_ref$dynamicElements===void 0?false:_ref$dynamicElements;_classCallCheck(this,crowdin_plugin);this.button_id=buttonId;this.hotkey=hotkey;this.trigger=trigger;this.configuration_key=configurationKey;this.dynamicElements=dynamicElements;if(this.disable_plugin()){return}this.hotkey_key=this.hotkey;this.button_title=$(this.button_id).attr("title");this._setup()}_createClass(crowdin_plugin,[{key:"run",value:function run(){}},{key:"init_hotkey",value:function init_hotkey(){if(this.hotkey_key){this.hotkey=crowdin.hotkeys.get(this.hotkey_key)}}},{key:"setup_action_button",value:function setup_action_button(){var _this=this;if(this.button_id==null){return}var self=this;var actionButtonFn=function actionButtonFn(eventTarget){if(_this.trigger){var enable=!_this.enabled();$(eventTarget)[enable?"addClass":"removeClass"]("active");if(_this.configuration_key){crowdin.user.settings[_this.configuration_key]=enable}_this.run()}else{_this.run()}};if(this.dynamicElements){$(document).on("click",'[id^="'+this.button_id+'"]',(function(e){self.dynamicButtonId=this.id;actionButtonFn(this);e.preventDefault()}))}else{$(this.button_id).click((function(e){actionButtonFn(this);e.preventDefault()}))}$(this.button_id)[this.enabled()?"addClass":"removeClass"]("active").data("plugin",1)}},{key:"rebind_action_button",value:function rebind_action_button(){var button=$(this.button_id);if(button.length===0){return}if(typeof button.data("plugin")==="undefined"){this.setup_action_button()}}},{key:"enabled",value:function enabled(){if(this.configuration_key){return crowdin.user.settings[this.configuration_key]}else{return false}}},{key:"_setup",value:function _setup(){this.setup_action_button();this.setup(this.enabled())}},{key:"setup",value:function setup(){}},{key:"run_with_highlight",value:function run_with_highlight(e){if(this.disable_plugin()){return}var self=this;var hl_timeout=null;var buttonId=self.button_id;if(self.dynamicElements){var btnIdAttribute=$(e.target).data("button-id");buttonId="#".concat(btnIdAttribute)}if(self.trigger&&buttonId){var enable=!self.enabled();$(buttonId)[enable?"addClass":"removeClass"]("active");if(self.configuration_key){crowdin.user.settings[self.configuration_key]=enable}self.run()}else{$(buttonId).addClass("active");clearTimeout(hl_timeout);hl_timeout=setTimeout((function(){$(buttonId).removeClass("active")}),150);self.run()}if(this.button_id&&this.button_title){$(this.button_id).attr("title",this.button_title+" ("+this.hotkey+")")}}}]);return crowdin_plugin}();var clear_text_plugin=function(_crowdin_plugin){_inherits(clear_text_plugin,_crowdin_plugin);var _super=_createSuper(clear_text_plugin);function clear_text_plugin(){_classCallCheck(this,clear_text_plugin);return _super.call(this,{trigger:false,buttonId:"#action_clear"})}_createClass(clear_text_plugin,[{key:"run",value:function run(){crowdin.translation.setValue("");crowdin.translation.focus()}}]);return clear_text_plugin}(crowdin_plugin);var copy_source_plugin=function(_crowdin_plugin2){_inherits(copy_source_plugin,_crowdin_plugin2);var _super2=_createSuper(copy_source_plugin);function copy_source_plugin(buttonId){_classCallCheck(this,copy_source_plugin);return _super2.call(this,{buttonId:buttonId?buttonId:"#action_copy_source",hotkey:"copy_source_key",trigger:false,configurationKey:null,dynamicElements:!!buttonId})}_createClass(copy_source_plugin,[{key:"run",value:function run(){if(crowdin.translation.hasOwnProperty("isTranslationLoading")&&crowdin.translation.isTranslationLoading()){return}else{var identifier=null;if(this.dynamicButtonId&&crowdin.editor.modeProofread()){identifier=$("#".concat(this.dynamicButtonId)).data("suggestion-area");$(".proofread-string-translation","#phrases").removeClass("selected");$(identifier).closest(".proofread-string-translation").addClass("selected")}crowdin.translation.focus(identifier);var sourceString=crowdin.translation.get_appropriate_source_text("source");if(crowdin.translation.is_icu||crowdin.editor.modeReviewProofread()&&crowdin.translation.data.is_icu){var icuHelper=new IcuHelper(sourceString);sourceString=icuHelper.getModifiedString()}crowdin.translation.setValue(sourceString);crowdin.trackEvent("Editor","Copy source key")}}}]);return copy_source_plugin}(crowdin_plugin);var copy_source_skeleton_plugin=function(_crowdin_plugin3){_inherits(copy_source_skeleton_plugin,_crowdin_plugin3);var _super3=_createSuper(copy_source_skeleton_plugin);function copy_source_skeleton_plugin(){_classCallCheck(this,copy_source_skeleton_plugin);return _super3.call(this,{buttonId:"copy-source-skeleton",hotkey:"copy_source_skeleton_key",trigger:false,configurationKey:null,dynamicElements:true})}_createClass(copy_source_skeleton_plugin,[{key:"run",value:function run(){var isSelectedOnlyOneString=!crowdin.phrases_list||crowdin.phrases_list.get_selected_items().length===1,isTranslationLoading=crowdin.translation.hasOwnProperty("isTranslationLoading")&&crowdin.translation.isTranslationLoading();if(isSelectedOnlyOneString&&!isTranslationLoading){crowdin.translation.focus(null);crowdin.translation.setValue(crowdin.translation.getSourceSkeleton());crowdin.trackEvent("Editor","Copy source skeleton")}}}]);return copy_source_skeleton_plugin}(crowdin_plugin);var crowdins_string_plugin=function(_crowdin_plugin4){_inherits(crowdins_string_plugin,_crowdin_plugin4);var _super4=_createSuper(crowdins_string_plugin);function crowdins_string_plugin(){_classCallCheck(this,crowdins_string_plugin);return _super4.call(this,{hotkey:"string_key"})}_createClass(crowdins_string_plugin,[{key:"run",value:function run(){if(crowdin.user.hasManagerAccessToProject()){crowdin.translation.toggle_visibility(!crowdin.models.phrases.get_translation(crowdin.translation.translation_id)["hidden"])}}}]);return crowdins_string_plugin}(crowdin_plugin);var crowdins_context_plugin=function(_crowdin_plugin5){_inherits(crowdins_context_plugin,_crowdin_plugin5);var _super5=_createSuper(crowdins_context_plugin);function crowdins_context_plugin(){_classCallCheck(this,crowdins_context_plugin);return _super5.call(this,{buttonId:"#action_extended_info",hotkey:"context_key",trigger:true,configurationKey:"translation_context_visibility"})}_createClass(crowdins_context_plugin,[{key:"run",value:function run(){crowdin.editor.view.setState({updatePhrases:true});crowdin.editor.layout.resizeSuggestions();crowdin.user.update_settings()}}]);return crowdins_context_plugin}(crowdin_plugin);var proofread_extended_info=function(_crowdin_plugin6){_inherits(proofread_extended_info,_crowdin_plugin6);var _super6=_createSuper(proofread_extended_info);function proofread_extended_info(){_classCallCheck(this,proofread_extended_info);return _super6.call(this,{buttonId:"#action_extended_info",hotkey:"context_key",trigger:true,configurationKey:"translation_context_visibility"})}_createClass(proofread_extended_info,[{key:"run",value:function run(){this.toggle_info(this.enabled());crowdin.user.update_settings()}},{key:"setup",value:function setup(){var status=crowdin.user.settings.translation_context_visibility;this.toggle_info(status)}},{key:"toggle_info",value:function toggle_info(status){$("#phrases")[status===false?"removeClass":"addClass"]("extended")}}]);return proofread_extended_info}(crowdin_plugin);var approve_phrase=function(_crowdin_plugin7){_inherits(approve_phrase,_crowdin_plugin7);var _super7=_createSuper(approve_phrase);function approve_phrase(){var args=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;_classCallCheck(this,approve_phrase);var constructorArgs=args?args:{hotkey:"approve_key"};return _super7.call(this,constructorArgs)}_createClass(approve_phrase,[{key:"disable_plugin",value:function disable_plugin(){return!crowdin.user.is_leader}},{key:"action",value:function action(_action){var suggestion=crowdin.suggestions.suggestions_list.get_selected_items();var id=suggestion.data("id");var suggestions=crowdin.suggestions.get_suggestions();if(suggestions.length){var top_suggestion=suggestions[0]}if(typeof id!=="undefined"){if(id>0){this._action(id,_action)}}else if(typeof top_suggestion!=="undefined"){var text="";if(typeof crowdin.translation.getValue!=="undefined"){text=crowdin.phrases.markup_replacer().unmask(crowdin.translation.getValue())}if(!text||text===top_suggestion.text){id=top_suggestion.id;this._action(id,_action)}}}},{key:"_action",value:function _action(id,action){if(action==="approve"){crowdin.suggestions.approve_suggestion(id)}else{crowdin.suggestions.disapprove_suggestion(id)}crowdin.trackEvent("Editor","Approve/Dissaprove suggestion",action)}},{key:"run",value:function run(){this.action("approve")}}]);return approve_phrase}(crowdin_plugin);var disapprove_phrase=function(_approve_phrase){_inherits(disapprove_phrase,_approve_phrase);var _super8=_createSuper(disapprove_phrase);function disapprove_phrase(){_classCallCheck(this,disapprove_phrase);return _super8.call(this,{hotkey:"disapprove_key"})}_createClass(disapprove_phrase,[{key:"run",value:function run(){this.action("disapprove")}}]);return disapprove_phrase}(approve_phrase);var proofread_approve_phrase=function(_crowdin_plugin8){_inherits(proofread_approve_phrase,_crowdin_plugin8);var _super9=_createSuper(proofread_approve_phrase);function proofread_approve_phrase(){var args=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;_classCallCheck(this,proofread_approve_phrase);var constructorArgs=args?args:{buttonId:"#action-approve-selected",hotkey:"approve_key"};return _super9.call(this,constructorArgs)}_createClass(proofread_approve_phrase,[{key:"disable_plugin",value:function disable_plugin(){return!crowdin.user.is_leader}},{key:"action",value:function action(_action2){var ids=[];if(crowdin.phrases.all_phrases_in_file){ids=["all"]}else{ids=crowdin.phrases.get_selected_translations_id()}if(!ids.length){return}this._action(ids,_action2)}},{key:"_action",value:function _action(ids,action){if(ids.length===1&&ids[0]!=="all"){var action_all_plurals=crowdin.translation.plural_id!==-1;var suggestion=crowdin.suggestions.suggestions_list.get_selected_items();var s_id=suggestion.data("id");if(typeof s_id==="undefined"){var top_suggestion=crowdin.suggestions.get_suggestions()[0];s_id=top_suggestion?top_suggestion.id:0}if(s_id){if(action_all_plurals){action==="approve"?crowdin.suggestions.approve_multiple(ids):crowdin.suggestions.disapprove_multiple(ids)}else{action==="approve"?crowdin.suggestions.approve_suggestion(s_id):crowdin.suggestions.disapprove_suggestion(s_id)}}}else{action==="approve"?crowdin.suggestions.approve_multiple(ids):crowdin.suggestions.disapprove_multiple(ids)}}},{key:"run",value:function run(){this.action("approve")}}]);return proofread_approve_phrase}(crowdin_plugin);var proofread_disapprove_phrase=function(_proofread_approve_ph){_inherits(proofread_disapprove_phrase,_proofread_approve_ph);var _super10=_createSuper(proofread_disapprove_phrase);function proofread_disapprove_phrase(){_classCallCheck(this,proofread_disapprove_phrase);return _super10.call(this,{buttonId:"#action-disapprove-selected",hotkey:"disapprove_key"})}_createClass(proofread_disapprove_phrase,[{key:"run",value:function run(){this.action("disapprove")}}]);return proofread_disapprove_phrase}(proofread_approve_phrase);var vote_plus_phrase=function(_crowdin_plugin9){_inherits(vote_plus_phrase,_crowdin_plugin9);var _super11=_createSuper(vote_plus_phrase);function vote_plus_phrase(){var args=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;_classCallCheck(this,vote_plus_phrase);var constructorArgs=args?args:{configurationKey:"vote_plus_phrase",hotkey:"vote_plus_key"};return _super11.call(this,constructorArgs)}_createClass(vote_plus_phrase,[{key:"disable_plugin",value:function disable_plugin(){return crowdin.user.is_leader}},{key:"action",value:function action(mark){var suggestion=crowdin.suggestions.suggestions_list.get_selected_items();var id=suggestion.data("id");var suggestions=crowdin.suggestions.get_suggestions();if(suggestions.length){var top_suggestion=suggestions[0]}if(typeof id!=="undefined"){if(id>0){this._action(id,mark)}}else if(typeof top_suggestion!=="undefined"){var text="";if(typeof crowdin.translation.getValue!=="undefined"){text=crowdin.phrases.markup_replacer().unmask(crowdin.translation.getValue())}if(!text||text===top_suggestion.text){id=top_suggestion.id;this._action(id,mark)}}}},{key:"_action",value:function _action(id,mark){crowdin.suggestions.vote_for_suggestion(id,mark)}},{key:"run",value:function run(){this.action("plus")}}]);return vote_plus_phrase}(crowdin_plugin);var vote_minus_phrase=function(_vote_plus_phrase){_inherits(vote_minus_phrase,_vote_plus_phrase);var _super12=_createSuper(vote_minus_phrase);function vote_minus_phrase(){_classCallCheck(this,vote_minus_phrase);return _super12.call(this,{configurationKey:"vote_minus_phrase",hotkey:"vote_minus_key"})}_createClass(vote_minus_phrase,[{key:"run",value:function run(){this.action("minus")}}]);return vote_minus_phrase}(vote_plus_phrase);var proofread_vote_plus_phrase=function(_crowdin_plugin10){_inherits(proofread_vote_plus_phrase,_crowdin_plugin10);var _super13=_createSuper(proofread_vote_plus_phrase);function proofread_vote_plus_phrase(){var args=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;_classCallCheck(this,proofread_vote_plus_phrase);var constructorArgs=args?args:{hotkey:"vote_plus_key"};return _super13.call(this,constructorArgs)}_createClass(proofread_vote_plus_phrase,[{key:"disable_plugin",value:function disable_plugin(){return crowdin.user.is_leader}},{key:"action",value:function action(mark){var id=crowdin.phrases.get_selected_translations_id();if(id.length===1){this._action(id,mark)}}},{key:"_action",value:function _action(id,mark){var suggestion=crowdin.suggestions.suggestions_list.get_selected_items();var s_id=suggestion.data("id");if(typeof s_id==="undefined"){var top_suggestion=crowdin.suggestions.get_suggestions()[0];s_id=top_suggestion.id}if(s_id){crowdin.suggestions.vote_for_suggestion(s_id,mark)}}},{key:"run",value:function run(){this.action("plus")}}]);return proofread_vote_plus_phrase}(crowdin_plugin);var proofread_vote_minus_phrase=function(_proofread_vote_plus_){_inherits(proofread_vote_minus_phrase,_proofread_vote_plus_);var _super14=_createSuper(proofread_vote_minus_phrase);function proofread_vote_minus_phrase(){_classCallCheck(this,proofread_vote_minus_phrase);return _super14.call(this,{hotkey:"vote_minus_key"})}_createClass(proofread_vote_minus_phrase,[{key:"run",value:function run(){this.action("minus")}}]);return proofread_vote_minus_phrase}(proofread_vote_plus_phrase);var concordance=function(_crowdin_plugin11){_inherits(concordance,_crowdin_plugin11);var _super15=_createSuper(concordance);function concordance(){_classCallCheck(this,concordance);return _super15.call(this,{buttonId:"#search-tm-action"})}_createClass(concordance,[{key:"getConcordanceHtml",value:function getConcordanceHtml(){return'<div class="concordance-input clearfix">'+'<div class="input-search-string">'+'<input id="concordance-query" type="text" class="form-control input-block-level" placeholder="'+_l("editor.searchThroughTM")+'" />'+'<button id="clear-concordance-query" tabindex="-1" class="input-clear" title="'+_l("generic.clear")+'"></button>'+"</div>"+"</div>"+'<div id="concordance_list" class="selectable"></div>'+'<div id="concordance_help" class="unselectable">'+"<p>"+_l("editor.searchTMDescription")+"</p>"+'<h5 class="margin-top">'+_l("generic.help")+"</h5>"+"<ul>"+"<li>"+_l("editor.searchTMExcludeWords")+"</li>"+"<li>"+_l("editor.searchTMExcactCombinations")+"</li>"+"</ul>"+"</div>"}},{key:"get_concordance_tpl",value:function get_concordance_tpl(item){var dir_source=crowdin.editor.source_language.text_direction;var dir_translation=crowdin.editor.target_language.text_direction;return'\n      <div class="concordance-item">\n        <div class="suggestion-text">\n          <div class="suggestion_tm_source" style="direction:'.concat(dir_source,'">').concat(item.source,'</div>\n          <div class="suggestion_tm_translation" style="direction: ').concat(dir_translation,'">').concat(htmlspecialchars(item.translation),'</div>\n        </div>\n        <div class="suggestion-author">\n          <nobr>').concat(htmlspecialchars(item.source_name),"</nobr>\n          ").concat(item.updated_at?', \n            <span class="suggestion-time-concordance" data-datetime="'.concat(item.updated_at,'" data-timeformat="').concat(TIME_AM_PM?"hh:mm A":"HH:mm",'"></span>'):""," \n        </div>\n      </div>\n    ")}},{key:"run",value:function run(){var $dialog=$("#concordance-dialog");$dialog.dialog("open");$dialog.find("#concordance-query").focus()}},{key:"setup",value:function setup(){var self=this;this.concordance_query="";this.concordance_timeout=null;$("#concordance").html(this.getConcordanceHtml());$("#concordance-query").on("input propertychange",(function(){$(this).parent()[this.value?"addClass":"removeClass"]("has-text");self.load_concordance(this.value)}));$("#concordance-query").on("keydown",(function(e){if(e.which===27){if(crowdin.editor.modeTranslate()){crowdin.translation.area.focus()}else if(crowdin.editor.modeReviewProofread()){document.getElementById("phrases").focus()}else if(crowdin.editor.modeAssets()){document.getElementById("suggestions-wrapper").focus()}}}));$("#clear-concordance-query").click((function(){$("#concordance-query").val("").trigger("input").focus();return false}));$("#concordance_tab a").on("shown",(function(){if(!is_mobile_device.any()){$("#concordance-query").focus()}}));$("#concordance_list").on("click","#alignment_concordance_header",(function(e){e.preventDefault();var $elem=$(e.target);var isPreviousTranslationsVisible=!parseInt($elem.data("visible"));$elem.data("visible",+isPreviousTranslationsVisible);$elem[isPreviousTranslationsVisible?"addClass":"removeClass"]("active");$("#alignment_concordance_context")[isPreviousTranslationsVisible?"removeClass":"addClass"]("hidden")}));crowdin.editor.on("updateLanguage",(function(){self._load_concordance()}))}},{key:"search_concordance",value:function search_concordance(query){$("#concordance_tab a").tab("show");$("#concordance-query").val(query).trigger("input");if(crowdin.editor.modeReviewProofread()){crowdin.panel.show()}}},{key:"toggle_search_concordance",value:function toggle_search_concordance(){if(!crowdin.editor.layout.isOpened("right")){crowdin.panel.toggle_panel()}$("#concordance_tab a").tab("show");$("#concordance-query").focus()}},{key:"load_concordance",value:function load_concordance(query){var self=this;clearTimeout(this.concordance_timeout);if(query.length===0){this.concordance_query="";this._load_concordance();return}this.concordance_timeout=setTimeout((function(){self.concordance_query=query;self._load_concordance()}),600)}},{key:"_load_concordance",value:function _load_concordance(){var self=this;$("#concordance_help").hide();$("#concordance-query").parent().addClass("is-loading");if(this.concordance_query.length){crowdin.ajax.getData("/suggestions/concordance",{project_id:crowdin.editor.project.id,target_language_id:crowdin.editor.target_language.id,source_language:crowdin.editor.source_language.internal_code,target_language:crowdin.editor.target_language.internal_code,query:this.concordance_query,user_id:crowdin.editor.project.owner.id,translation_id:crowdin.translation.translation_id},(function(response){if(response.query!==self.concordance_query){return}$("#concordance-query").parent().removeClass("is-loading");self.renderConcordance(response)}))}else{self.renderEmptyConcordance()}}},{key:"renderConcordance",value:function renderConcordance(response){var html="";if(Object.keys(response.alignments).length>0){var isPreviousTranslationsVisible=0;html+='\n        <div class="concordance_separator alignments_concordance_separator unselectable clearfix">\n          <a href="#" id="alignment_concordance_header" data-visible="'.concat(+isPreviousTranslationsVisible,'" class="pull-left toggle ').concat(isPreviousTranslationsVisible?"active":"",'">\n            ').concat(_l("editor.previousTranslations"),"\n          </a>\n        </div>");var dir_source=crowdin.editor.source_language.text_direction;var dir_translation=crowdin.editor.target_language.text_direction;html+='<div id="alignment_concordance_context" class="'.concat(isPreviousTranslationsVisible?"":"hidden",'">');for(var word in response.alignments){html+=""+'<div class="concordance-item alignment-item">'+'<div class="suggestion-text">'+'<div class="suggestion_tm_source" style="direction: '+dir_source+'">'+word+"</div>";for(var i=0;i<response.alignments[word].length;i++){html+=""+'<div class="suggestion_tm_translation" style="direction: '+dir_translation+'">'+response.alignments[word][i].source_word+" → "+response.alignments[word][i].target_word+" "+'<span class="badge">'+response.alignments[word][i].match+"</span>"+"</div>"}html+="</div></div></div>"}}if(response.strings.length>0){html+='<div class="concordance_separator"><span>'+_l("editor.TMResults")+"</span></div>";for(var i=0;i<response.strings.length;i++){html+=this.get_concordance_tpl(response.strings[i])}}if(response.strings.length===0&&response.alignments.length===0&&response.query.length>0){html='<div class="no_suggestions_yet">'+_l("editor.noMathingTranslationFound")+"</div>"}if(!response.success){html='<div class="no_suggestions_yet">'+(response.msg?response.msg:_l("editor.errorLoadingData"))+"</div>"}$("#concordance_list").html(html);$(".suggestion-time-concordance").momentlive();$("#concordance_help")[html.length?"hide":"show"]()}},{key:"renderEmptyConcordance",value:function renderEmptyConcordance(){this.renderConcordance({success:true,strings:[],alignments:[],query:""})}}]);return concordance}(crowdin_plugin);var contact_manager=function(_crowdin_plugin12){_inherits(contact_manager,_crowdin_plugin12);var _super16=_createSuper(contact_manager);function contact_manager(){_classCallCheck(this,contact_manager);return _super16.call(this,{buttonId:"#editor_open_contact_manager",hotkey:false})}_createClass(contact_manager,[{key:"setup",value:function setup(){var $form=$("#send_message");if(INIT_MANAGERS.length===0){$("#editor_open_contact_manager").parent().addClass("disabled");return}this.init_dialog();this.getManagersList();$form.crowdinValidator({rules:{to:{name:"to"},subject:{name:"subject"},message:{name:"message"}},onkeyup:true,errorPlacement:function errorPlacement(error,element){if(element.attr("name")==="to"){error.insertAfter(element.closest("#button_select_managers"))}else{error.insertAfter(element)}},ignore:{}})}},{key:"run",value:function run(){if(INIT_MANAGERS.length===0){return}$("#editor_contact_manager_dialog").dialog("open")}},{key:"init_dialog",value:function init_dialog(){$("#editor_contact_manager_dialog").dialog({autoOpen:false,width:600,resizable:false,draggable:!IS_MOBILE,modal:true,buttons:this._getButtons(),open:function open(e,ui){$("#input-mail-subject").val(_l("editor.contactManagerTitle",{projectName:crowdin.editor.project.name}));crowdin.editor.fit_dialog($(this))},beforeClose:function beforeClose(){$("#send_message").data("validator").resetForm()}})}},{key:"_getButtons",value:function _getButtons(){var self=this,buttons={};buttons[_l("generic.cancel")]=function(){$("#editor_contact_manager_dialog").dialog("close")};buttons[_l("generic.send")]=function(){self.send()};return buttons}},{key:"send",value:function send(){var $form=$("#send_message");if(!$form.valid()){return false}$form.mask(_l("generic.sendingD"),true);crowdin.ajax.postData("/messaging/contact",$form.serialize(),(function(response){$form.unmask();if(!check_acl(response)){return}if(response.success){if(response.send_email_error){$form.hide().after('<div class="alert alert-block alert-error">'+_l("editor.contactManagerError")+"</div>");return false}if(response.message_sent){$.jGrowl(_l("editor.contactManagerSuccess"),{theme:"jGrowl-success"});$("#input-mail-subject").val("");$("#input-mail-body").val("");$("#editor_contact_manager_dialog").dialog("close");return true}}else{if(response.empty_fields_error){$.jGrowl(_l("editor.contactManagerEmptyFieldsError"),{theme:"jGrowl-error"});return false}$.jGrowl(_l("error.internalError"),{theme:"jGrowl-error"})}}),null,false,true);return false}},{key:"getManagersList",value:function getManagersList(){var self=this;var change_fn=function change_fn(id,item){var $field=$("#input-main-to");var validator=$("#send_message").data("validator");$field.val(id);if(validator){validator.element($field)}};self.checklist=new checklist_single({list_selector:"#manager_list",filter_selector:"#manager_filter",result_selector:"#result_manager_list",result_placeholder:_l("editor.selectManager"),filter_placeholder:_l("editor.searchManagers"),empty_result_msg:_l("generic.nothingToDisplay"),item_tpl:function item_tpl(item){return""+'<li data-id="'+item.id+'" class="item-checklist">'+(item.avatar?'<img class="users_list_img s-margin-right" src="'+item.avatar+'">':"")+'<span class="name_user">'+htmlspecialchars(item.name)+"</span>"+(item.is_owner?'<span class="label label-default label-checklist">'+_l("editor.ownerL")+"</span>":"")+"</li>"},result_tpl:function result_tpl(item){return'<span data-id="'+htmlspecialchars(item.id)+'">'+htmlspecialchars(item.name)+"</span>"},change:change_fn,data:[{title:"",data:INIT_MANAGERS}]});self.checklist.render()}}]);return contact_manager}(crowdin_plugin);var open_file=function(_crowdin_plugin13){_inherits(open_file,_crowdin_plugin13);var _super17=_createSuper(open_file);function open_file(){var _this2;_classCallCheck(this,open_file);_this2=_super17.call(this,{buttonId:"#editor_open_file_button",hotkey:"open_file_key"});_this2.recent_files=new storage({limit:6,key:crowdin.editor.project.id+"_recent_files"});return _this2}_createClass(open_file,[{key:"setup",value:function setup(){var _this3=this;this.files_outdated=true;this.files_outdated_timeout=null;this.show_hiden_files=false;this.selected_id=null;this.files=null;this.selected_file_exist=true;var self=this;var $open_file_dialog=$('<div id="change_file_dialog" title="'+_l("editor.openFileTitle")+'">').css({padding:0}).appendTo("body");var current_file_html='<div class="muted text-overflow" id="select-active" style="padding: 6px 0; max-width: 350px;">&nbsp;</div>';var hidden_html=crowdin.user.is_leader?'<button title=" '+_l("editor.hiddenFiles")+'" id="show_hidden_files" class="btn btn-icon pull-left">'+'<i class="static-icon-eye-closed"></i>'+"</button>":"";var file_not_found_alert=""+'<div class="alert hidden" style="margin-bottom: 0px;">'+(INIT_MANAGERS.length?_l("openFileDialog.fileNotFoundContactWithProjectManager",{className:"alert-link contact-with-manager",url:"javascript:crowdin.plugins.contact_manager.run();"}):_l("openFileDialog.fileNotFound"))+"</div>";var html=""+'<div class="clearfix btn-toolbar" style="padding: 0 10px;">'+'<div id="editor_files_filter" class="pull-right"></div>'+'<button id="open_all_strings" class="btn mdc-button pull-left">'+_l("editor.allStrings")+"</button>"+hidden_html+"</div>"+file_not_found_alert+'<div id="change_file_manager" style="border-top: 1px solid #d5d5d5"></div>';$open_file_dialog.html(html);$open_file_dialog.dialog({autoOpen:false,height:700,resizable:false,draggable:!IS_MOBILE,zIndex:1e5,modal:true,buttons:[{text:_l("generic.cancel"),id:"cancel-file-dialog-btn",click:function click(){$open_file_dialog.dialog("close")}},{text:_l("generic.open"),click:function click(){if(_this3.selected_id){$open_file_dialog.dialog("close");_this3.changeFile(_this3.selected_id)}}}],open:function open(e,ui){$open_file_dialog.dialog({closeOnEscape:crowdin.editor.file});$("#change_file_dialog .alert")[!crowdin.editor.file?"removeClass":"addClass"]("hidden");!crowdin.editor.file?self.hideClosingDialogButtons():self.showClosingDialogButtons();if(!self.selected_file_exist){$("#change_file_dialog .alert").removeClass("hidden");self.selected_file_exist=true}crowdin.editor.fit_dialog($open_file_dialog)},beforeClose:function beforeClose(){$(window).off(".open_file_dialog_resize")}});$open_file_dialog.parent().find(".ui-dialog-buttonpane").append(current_file_html);var smart_search_assets=_l("editor.smartSearchAssets");var assetSearch=function assetSearch(file){return file.type==="assets"};var getWordsToTranslate=function getWordsToTranslate(file){var title_tpl,title_tpl_asset,title,value,class_name,val=file.total-file.translated;if(val>0){title_tpl=_l("editor.openFileNotTranslated2D",{words:_l("generic.nWords",{words:val})});title_tpl_asset=_l("editor.notTranslated");title=file.type==="assets"?title_tpl_asset:title_tpl;value=file.type==="assets"?"•":short_number_format(val);class_name="untranslated"}else{var empty_file=!file.total;title=empty_file?_l("editor.nothingToTranslate"):_l("editor.translated");value=empty_file?"—":"•";class_name=empty_file?"":"ready"}return["span.file-words-count "+class_name,{title:title,"data-animation":false,"data-container":"body","data-placement":"left","data-delay":100},value]};var getWordsToApprove=function getWordsToApprove(file){var title_tpl,title_tpl_asset,title,value,class_name,val=file.translated-file.approved;if(val>0){title_tpl=_l("editor.openFileNotApproved2D",{words:_l("generic.nWords",{words:val})});title_tpl_asset=_l("editor.notApproved");title=file.type==="assets"?title_tpl_asset:title_tpl;value=file.type==="assets"?"•":short_number_format(val);class_name="unapproved"}else{var all_approved=file.total>0&&file.total===file.approved;title=all_approved?_l("editor.approved"):_l("editor.nothingToApprove");value=all_approved?"•":"—";class_name=all_approved?"ready":""}return["span.file-words-count "+class_name,{title:title,"data-animation":false,"data-container":"body","data-placement":"left","data-delay":100},value]};var getPriority=function getPriority(file){var name_priority="";var msg_priority="";var file_priority=null;if(file.priority!==null&&+file.priority===0||+file.priority===2){if(+file.priority===0){name_priority="static-icon-low-priority";msg_priority=_l("fileManager.lowPriority")}else{name_priority="static-icon-high-priority";msg_priority=_l("fileManager.highPriority")}file_priority=["div.file-priority",{"data-container":"body","data-original-title":msg_priority,"data-animation":false,"data-delay":100},["i.static-icon "+name_priority]]}return file_priority};var showApprovedWords=crowdin.editor.modeReviewProofread();var modelContentWordsTitle=showApprovedWords?_l("editor.notApprovedWords"):_l("editor.notTranslatedWords");var getWords=function getWords(file){return showApprovedWords?getWordsToApprove(file):getWordsToTranslate(file)};this.files=new files({container:"#change_file_manager",autorender:false,model:[{content:getWords,title:["span.pull-right",modelContentWordsTitle],width:"70px",align:"right",className:"muted node-words-untranslated"},{content:getPriority,title:["span",{title:_l("editor.priority")},_l("editor.priorityShort")],align:"center",width:"40px",className:"muted"}],url:"/translation/project_files",params:{project_id:crowdin.editor.project.id,language_id:function language_id(){return crowdin.editor.target_language?crowdin.editor.target_language.id:0},workflow_step_id:crowdin.editor.workflow_step.id,task:crowdin.editor.getTaskHash()},storage_key:"crowdin_"+crowdin.editor.project.id+"_files",drag:false,dir:0,closed_by_default:false,item_select:function item_select(selected){self.selected_id=self.files.getNodeId(selected);var button=$open_file_dialog.parent().find(".ui-dialog-buttonpane button").eq(1);button[self.selected_id?"removeClass":"addClass"]("ui-state-disabled")},item_open:function item_open(item){var node_id=self.files.getNodeId(item);$open_file_dialog.dialog("close");self.changeFile(node_id)},items_update:function items_update(){$open_file_dialog.find(".file-words-count").tooltip("fixTitle")},items_reload:function items_reload(){self.files_outdated=false;clearTimeout(self.files_outdated_timeout);self.files_outdated_timeout=setTimeout((function(){self.files_outdated=true}),20*6e4);if(crowdin.editor.modeAssets()){crowdin.translation.data=self.getAssets();crowdin.translation._set_assets_paginator_data()}var has_hidden=self.files.getNodesFiltered((function(node){return!+node.total}));$("#show_hidden_files")[has_hidden.length?"removeClass":"addClass"]("hidden")},extra_sort:function extra_sort(data){var sorted_data=[];var priority={0:[],1:[],2:[]};for(var i=0;i<data.length;i++){priority[data[i].priority]&&priority[data[i].priority].push(data[i])}return sorted_data.concat(priority[2],priority[1],priority[0])},check_response:function check_response(response){if(response.success===false){return false}return true},hide_by_default:function hide_by_default(item){return!+item.total&&!self.show_hiden_files},show_empty_folders:false,smart_search:[[smart_search_assets,assetSearch]],singleselect:true,filter_container:"#editor_files_filter",filter_placeholder:_l("editor.searchFiles")});crowdin.editor.on("updateLanguage",(function(){self.files.refresh()}));this.bind_events()}},{key:"bind_events",value:function bind_events(){var self=this;$("#change_file_manager").tooltip({selector:".file-words-count, .file-priority"});$("#open_all_strings").click((function(){$("#change_file_dialog").dialog("close");self.changeFile("all")}));$("#select-active").on("click","a",(function(){self.select_active_file();files_focus();return false}));$("#show_hidden_files").on("click",(function(){$(this).toggleClass("active");$(this).find("i").toggleClass("static-icon-eye-closed static-icon-eye");self.show_hiden_files=$(this).hasClass("active");self.files.view.refresh()}));$(document).on("click","#suggest-next-file",(function(){self.changeFile($(this).data("id"));$(this).closest(".jGrowl-notification").remove()}));$(document).on("click","#select-file",(function(){$(this).closest(".jGrowl-notification").remove();self.run()}));$(document).on("click",".current-file-name a",(function(e){if(!e.shiftKey&&!e.ctrlKey&&!e.metaKey){self.changeFile($(this).data("id"));return false}}));this.files.div[0].oncontextmenu=function(){return false};this.files.div.on("mousedown",".node-inner",(function(e){if(e.button===2){if(!$(this).hasClass("checked")){self.files.select.select(this)}self.show_context_menu(e)}}))}},{key:"select_active_file",value:function select_active_file(){var self=this;var node=crowdin.editor.file?self.files.getNode(crowdin.editor.file.id):"";if(!node.id){self.files.select.disselect_all();return}var p_id=+node.parent_id;var while_loop=1e3;while(p_id!==0){self.files.expandFolder(p_id);p_id=+self.files.getNode(p_id).parent_id;if(!while_loop--){break}}function select(){return self.files.select.select("[data-id="+crowdin.editor.file.id+"]").length}var selected=select();if(!selected&&(self.files.search_query||+node.strings===0)){if(+node.strings===0){self.show_hiden_files=true;$("#show_hidden_files").prop("checked",true)}self.files.reset_filter();self.files.view.refresh();select()}}},{key:"show_context_menu",value:function show_context_menu(e){var id=this.files.getNodeId(e.target);this._show_context_menu(id,{top:e.pageY,left:e.pageX})}},{key:"_show_context_menu",value:function _show_context_menu(id,coords){var self=this;$("#editor_files_context_menu").remove();if(+id===self.files.options.dir){return}var menu=$('<ul id="editor_files_context_menu" class="dropdown-menu node">').data("id",id);var result="";var url=crowdin.editor.getFileUrl(id);result+='<li><a target="_blank" href="'+url+'">'+_l("editor.openInNewTab")+"</li>";menu.html(result);menu.appendTo("body").css(coords);menu[0].oncontextmenu=function(){return false};setTimeout((function(){menu.addClass("shown");self.bind_context_menu()}),0)}},{key:"bind_context_menu",value:function bind_context_menu(){var self=this;var menu=$("#editor_files_context_menu");var active_click=false;$(document).on("mousedown.fm_context_menu touchstart.fm_context_menu",(function(e){if(!$(e.target).closest("#editor_files_context_menu").length){menu.removeClass("shown");if(!$(e.target).closest(".files-dropmenu.active").length){self.files.div.find(".files-dropmenu").removeClass("active")}$(document).off(".fm_context_menu")}active_click=true}));$(document).on("mouseup.fm_context_menu touchend.fm_context_menu",(function(e){if(active_click){menu.removeClass("shown");if(!$(e.target).closest(".files-dropmenu").length){self.files.div.find(".files-dropmenu").removeClass("active")}$(document).off(".fm_context_menu");active_click=false}}))}},{key:"saveOpenedNow",value:function saveOpenedNow(){var id=+crowdin.editor.file.id;if(crowdin.editor.file.id!=="all"){if(this.recent_files.has(id)){this.recent_files._renew(id)}else{this.recent_files.set(id,crowdin.editor.file)}}}},{key:"changeFileReloadPage",value:function changeFileReloadPage(node_id,mode){setTimeout((function(){crowdin.helpers.url.redirect(crowdin.editor.getCustomFileUrl(node_id,mode))}),0)}},{key:"getNextEditorMode",value:function getNextEditorMode(node_id,node){var mode=null;var is_assets_view=crowdin.editor.getFileView(node)==="assets"||node.assets_only;if(node_id==="all"&&crowdin.editor.modeAssets()){mode="translate"}else{if(is_assets_view){mode="assets"}else{mode=crowdin.editor.modeAssets()?"translate":crowdin.editor.mode}}return mode}},{key:"changeFile",value:function changeFile(node_id,update_history){var node=this.files.getNode(node_id),old_is_glossary=crowdin.editor.is_glossary_file,old_view=crowdin.editor.modeAssets()?"assets":crowdin.phrases.version,new_file_view=crowdin.editor.getFileView(node),controller=crowdin.editor.modeAssets()?crowdin.translation:crowdin.phrases,asset_to_file=(old_view==="assets"||new_file_view==="assets")&&new_file_view!==old_view;if(node_id!=="all"&&!node.id||asset_to_file){this.changeFileReloadPage(node_id,this.getNextEditorMode(node_id,node));return}var self=this;if(+node.node_type!==this.files.ct.node_file){var child_translatable_files=this.files.getNodesByParent((function(node){return node.type!=="assets"&&+node.node_type===self.files.ct.node_file}),node.id);if(!child_translatable_files.length){this.changeFileReloadPage(node_id,this.getNextEditorMode(node_id,node));return}}if(node_id==="all"){crowdin.editor.setAllFiles()}else{crowdin.editor.setFile(node)}if(crowdin.editor.modeTranslate()){crowdin.editor.html_preview=crowdin.editor.isAbleToHtmlPreview(node);controller.update_version_editor()}crowdin.editor.afterChangeEditorFile(update_history);crowdin.user.set_texts_page(1);controller.refresh();if(crowdin.editor.modeTranslate()&&crowdin.editor.is_glossary_file!==old_is_glossary){crowdin.glossary.load(true)}this.showClosingDialogButtons();AppEvent.dispatchFileChange()}},{key:"getNextFile",value:function getNextFile(){var self=this;if(!crowdin.editor.file||crowdin.editor.isAllFilesSelected()){return null}function check_inside(parent_id,id){var next=null;var reached=typeof id==="undefined"?true:false;var siblings=self.files.getNodesFiltered((function(node){return node.parent_id===parent_id}));var siblings_sorted=self.files.sort_by_name(siblings);for(var i=0;i<siblings_sorted.length;i++){var node=siblings_sorted[i];if(!reached&&+node.id===+id){reached=true;continue}if(reached){if(+node.node_type===crowdin.editor.file_nodes.file&&node.type!=="assets"&&node.total>0){next=node;break}else{next=check_inside(node.id);if(next){break}}}}return next}var current_node=this.files.getNode(crowdin.editor.file.id);var while_loop=1e3;var next=null;while(!$.isEmptyObject(current_node)){next=check_inside(current_node.parent_id,current_node.id);if(next){break}current_node=self.files.getNode(current_node.parent_id);if(!while_loop--){console.error("Next file calculation error");return null}}return next}},{key:"getNextFileMsg",value:function getNextFileMsg(next_file){var txt=_l("editor.reachedEndOfFile");if(!next_file){return'<p style="margin:0;">'+txt+"</p>"}return"<p>"+txt+"</p>"+'<p class="text-small" style="margin-bottom: 2px;">'+_l("editor.nextFileMessage")+":"+"</p>"+"<p>"+'<span class="file_type file_'+next_file.type+'"></span>'+htmlspecialchars(next_file.name)+"</p>"+'<div class="jGrowl-default-buttons btn-toolbar">'+'<button class="btn btn-small" id="suggest-next-file" data-id="'+next_file.id+'">'+_l("editor.openNext")+"</button>"+'<button id="select-file" class="btn btn-small" data-url="/project/'+crowdin.editor.project.identifier+"/"+crowdin.editor.target_language.code+'">'+_l("editor.selectAnotherFile")+"</button>"+"</div>"}},{key:"hideClosingDialogButtons",value:function hideClosingDialogButtons(){$("#change_file_dialog").closest("div.ui-dialog").find(".ui-dialog-titlebar-close").hide();$("#cancel-file-dialog-btn").hide()}},{key:"showClosingDialogButtons",value:function showClosingDialogButtons(){$("#change_file_dialog").closest("div.ui-dialog").find(".ui-dialog-titlebar-close").show();$("#cancel-file-dialog-btn").show()}},{key:"getAssets",value:function getAssets(){return this.files.getNodesByParent((function(node){return node.type==="assets"}))}},{key:"fit",value:function fit(){var $dialog=$("#change_file_dialog");var $alertMessage=$dialog.find(".alert");var h=$dialog.parent().height()-$dialog.parent().find(".ui-dialog-titlebar").outerHeight()-$dialog.parent().find(".ui-dialog-buttonpane").outerHeight();var alertMessageHeight=$alertMessage.hasClass("hidden")?0:$alertMessage.outerHeight(true);$dialog.height(h);this.files.div.height(h-1-$("#editor_files_filter").parent().outerHeight(true)-alertMessageHeight)}},{key:"run",value:function run(){var self=this;if(this.files_outdated){this.files.refresh()}var text=_l("editor.currentlyOpened2D");if(crowdin.editor.isAllFilesSelected()){text+=" "+_l("editor.allStrings")}else{text+=' <a class="ajax-link" href="#">'+htmlspecialchars(crowdin.editor.file?crowdin.editor.file.name:"")+"</a>"}$("#select-active").html(!crowdin.editor.file?"":text);var dialog=$("#change_file_dialog");dialog.dialog("option","width",Math.max(Math.min(screen.width/.7,850),500)).dialog("open");this.fit();if(self.files.not_rendered){setTimeout((function(){self.files.view.refresh();self.select_active_file()}),0)}self.select_active_file();files_focus();if(IS_MOBILE){$(window).on("resize.open_file_dialog_resize",(function(){self.fit()}))}}}]);return open_file}(crowdin_plugin);
