"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var RightPanelView=function(_React$Component){_inherits(RightPanelView,_React$Component);var _super=_createSuper(RightPanelView);function RightPanelView(){_classCallCheck(this,RightPanelView);return _super.apply(this,arguments)}_createClass(RightPanelView,[{key:"componentDidMount",value:function componentDidMount(){this.bindEvents()}},{key:"render",value:function render(){var resultTemplate=["div",["div.editor-pane-mask mask-hidden"],["div.editor-pane-inner",["div.editor-btn-toolbar no-margin",["div.sidebar-switcher nav-tabs-wrapper",this.getRightPanelTabsTpl()]],["div.tab-content",this.getSuggestionsTabTpl(),this.getConcordanceTab(),this.getDiscussionsTabTpl(),this.getTermsTabTpl(),crowdin.apps.getRightPanelTabContentTpl()]]];return ReactCompile(resultTemplate)}},{key:"getRightPanelTabsTpl",value:function getRightPanelTabsTpl(){var result=["ul.nav nav-tabs no-margin"];if(crowdin.editor.modeReviewProofread()){var itemTitle=crowdin.editor.modeProofread()?_l("generic.translations"):_l("generic.corrections");result.push(["li",["a.text-overflow",{tabIndex:-1,"data-toggle":"tab",href:"#suggestions-wrapper",title:itemTitle},["i.static-icon-suggestions"]]])}result.push(["li",["a.text-overflow",{id:"comments_section",tabIndex:-1,"data-toggle":"tab",href:"#discussions_tab",title:_l("generic.comments")},["i.static-icon-comments"]]]);if(!crowdin.editor.modeAssets()){result.push(["li",{id:"concordance_tab"},["a.text-overflow",{tabIndex:-1,"data-toggle":"tab",href:"#concordance",title:_l("editor.searchTM")},["i.static-icon-tms"]]]);result.push(["li",["a.text-overflow"+(crowdin.editor.is_glossary_file?" hidden":""),{id:"project_glossaries",tabIndex:-1,"data-toggle":"tab",href:"#terms_tab",title:_l("generic.terms")},["i.static-icon-terms"]]])}result.push(crowdin.apps.getRightPanelTabTpl());return result}},{key:"getIcuPreviewTpl",value:function getIcuPreviewTpl(){if(!crowdin.editor.modeReviewProofread()||!crowdin.translation){return null}if(!crowdin.translation.data){return null}return[IcuPreview,{translation:crowdin.translation.data,area_selector:crowdin.translation.getTextareaSelector()}]}},{key:"getSuggestionsTabTpl",value:function getSuggestionsTabTpl(){if(!crowdin.editor.modeReviewProofread()){return null}return["div.tab-pane",{id:"suggestions-wrapper",tabIndex:0},this.getIcuPreviewTpl(),[SuggestionsView,{suggestionsLoaded:Boolean(this.props.suggestionsLoaded),tmAndMtSuggestionsLoaded:Boolean(this.props.tmAndMtSuggestionsLoaded),suggestions:this.props.suggestions,externalSuggestions:this.props.externalSuggestions,tms:this.props.tms,mts:this.props.mts,targetLanguageId:this.props.targetLanguageId}],!crowdin.editor.modeReview()?[OtherLanguagesView,{assistance:this.props.assistance,other:this.props.other,loaded:this.props.loaded}]:null]}},{key:"getConcordanceTab",value:function getConcordanceTab(){if(crowdin.editor.modeAssets()){return null}return["div.tab-pane",{id:"concordance"}]}},{key:"getDiscussionsTabTpl",value:function getDiscussionsTabTpl(){return["div.tab-pane in comments-list",{id:"discussions_tab"},[DiscussionsView,{messages:this.props.messages}],["div.add-comment",{id:"discussions_control",tabIndex:-1},["div.alert hidden",{id:"discussion_language_identify_notification"},_l("editor.writeMessageUsingSourceLanguage")],["div.invisible-textarea-wrapper",["textarea.input-block-level",{rows:5,tabIndex:4,placeholder:_l("editor.newComment"),style:{resize:"none"}}]],["div.discussions_control_footer no-margin",["div.hide mini-container",this.getTranslationDiscussionsSelectTpl()],["div.clearfix mini-container",["div.btn-toolbar pull-right nowrap",["button.btn btn-icon",{id:"discussion_post",tabIndex:7,title:_l("generic.sendHotkey",{hotkey:crowdin.hotkeys.get(crowdin.hotkeys.SAVE_COMMENT_KEY)})},["i.static-icon static-icon-send"]]],["label.checkbox pull-left text-left nowrap",{style:{margin:"17px 0"}},["input",{id:"discussion_create_issue",type:"checkbox",tabIndex:5}],_l("generic.issue")]]]]]}},{key:"getTranslationDiscussionsSelectTpl",value:function getTranslationDiscussionsSelectTpl(){return["select.input-block-level no-margin",{id:"discussion_issue_type",tabIndex:6},["option",{value:crowdin.editor.translation_discussions["constants"]["ISSUE_TYPE_GENERAL"]},crowdin.editor.translation_discussions["type_name"]["ISSUE_TYPE_GENERAL"]],!crowdin.editor.modeReview()?["option",{value:crowdin.editor.translation_discussions["constants"]["ISSUE_TYPE_POOR_TRANSLATION"]},crowdin.editor.translation_discussions["type_name"]["ISSUE_TYPE_POOR_TRANSLATION"]]:null,["option",{value:crowdin.editor.translation_discussions["constants"]["ISSUE_TYPE_LACK_CONTEXT"]},crowdin.editor.translation_discussions["type_name"]["ISSUE_TYPE_LACK_CONTEXT"]],!crowdin.editor.modeReview()?["option",{value:crowdin.editor.translation_discussions["constants"]["ISSUE_TYPE_WRONG_SOURCE_STRING"]},crowdin.editor.translation_discussions["type_name"]["ISSUE_TYPE_WRONG_SOURCE_STRING"]]:null]}},{key:"getTermsTabTpl",value:function getTermsTabTpl(){if(crowdin.editor.modeAssets()){return null}return["div.tab-pane",{id:"terms_tab"},["div.clearfix",["div.pull-left hidden glossary-input",{style:{paddingRight:0}},["button.btn btn-icon",{id:"add_new_term",tabIndex:-1,title:_l("editor.addTermHotkey",{hotkey:crowdin.hotkeys.get(crowdin.hotkeys.ADD_TERM_KEY)})},["i.static-icon static-icon-add-to-list"]]],["div.glossary-input",{style:{overflow:"hidden"}},["div.input-search-string",["input.input-block-level no-margin",{id:"search_terms",type:"text",tabIndex:-1,placeholder:_l("editor.typeToSearchGlossary")}],["button.input-clear",{id:"clear-terms-search",tabIndex:-1,title:_l("generic.clear")}]]]],["div.terms-list",{id:"terms-list"},["div.glossary_separator",["span",_l("generic.glossaries")],["a.hidden pull-right",{id:"manage-terms-link",tabIndex:-1,href:"#",target:"_blank"},_l("generic.manage")]],["div.terms-list-group",{id:"searched-list"}],["div.terms-list-group",{id:"current-list"}],["div.other_terms_separator",{style:{display:"none"}},["a.toggle active",{id:"other-terms-toggler",href:"#",tabIndex:-1},_l("generic.wikipedia")],[CircularLoader,{id:"other-terms-loader",className:"mini-loader",maskHeight:24,maskWidth:24,iconHeight:18,iconWidth:18,onDark:crowdin.user.settings.editor_color_theme==="dark"}]],["div.terms-list-group",{id:"other-terms-list"}]]]}},{key:"bindEvents",value:function bindEvents(){var send_btn=$("#discussion_post");var language_detection_timeout=null;$("#comments_section").on("shown",(function(){crowdin.panel&&crowdin.panel.force_fit()}));$("#discussions_control textarea").on("input",(function(){var discussion=crowdin.panel.get_discussion_object();crowdin.helpers.translation.update_unsaved_discussions_storage(crowdin.translation.translation_id,discussion);clearTimeout(language_detection_timeout);if(!$.trim(discussion.text)){$("#discussion_language_identify_notification").addClass("hidden");crowdin.panel.force_fit();return false}language_detection_timeout=setTimeout((function(){crowdin.panel.check_comment_language(discussion.text)}),800)}));send_btn.click((function(){crowdin.panel.discussion_post();return false}));$(document).on("click","a#restore-comment",(function(e){var $el=$(this);crowdin.panel.discussion_restore($el.data("m-id"));$el.closest(".undo-alert").detach();e.preventDefault()}));$("#discussion_create_issue").change((function(){$("#discussion_issue_type").parent()[$(this).prop("checked")?"show":"hide"]();crowdin.panel.force_fit();crowdin.helpers.translation.update_unsaved_discussions_storage(crowdin.translation.translation_id,crowdin.panel.get_discussion_object())}));$("#discussion_issue_type").change((function(){crowdin.helpers.translation.update_unsaved_discussions_storage(crowdin.translation.translation_id,crowdin.panel.get_discussion_object())}));$("#discussions_control textarea").focus((function(){crowdin.panel.activate_discussion_control()}));$(document).click((function(e){if(crowdin.panel&&!$(e.target).closest(crowdin.panel.panel_id).length){crowdin.panel.deactivate_discussion_control()}}));crowdin.models.phrases.on("changed.discussions",(function(translation_id){crowdin.panel.update_discussions_icon(translation_id)}));IS_MOBILE&&this.bindCommentOptions()}},{key:"bindCommentOptions",value:function bindCommentOptions(){$("#discussions_messages").on("click","li[id]",(function(e){if(e.target.nodeName==="A"||$(this).find(".edit_discussion_block, .deleted-comment").length){return}$(this).addClass("tap");var id=this.id.replace("discussion","");crowdin.panel.show_comment_options(id);e.preventDefault()}));$(document).on("click","a.mobile-comment-option",(function(e){crowdin.editor.layout.hideModalMenu();var id=$(this).closest(".modal-menu").data("id");var user=$(this).closest(".modal-menu").data("user");switch($(this).data("action")){case"edit":crowdin.panel.show_discussion_edit_control(id);break;case"reply":crowdin.panel.discussion_reply(user);break;case"resolve":crowdin.panel.discussion_resolve(id);break;case"delete":crowdin.panel.discussion_remove(id);break;case"abuse":crowdin.panel.abuse_discussion(id);break}e.preventDefault()}))}}]);return RightPanelView}(React.Component);
