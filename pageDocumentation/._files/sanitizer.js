"use strict";var sanitizer=new function(){this.uri_protocol_named_ref_map={Tab:"\t",NewLine:"\n"};this.uri_blacklist_protocols={javascript:1,data:1,vbscript:1,mhtml:1};this.uri_protocol_colon=/(?::|&#[xX]0*3[aA];?|&#0*58;?|&colon;)/;this.uri_protocols_whitespaces=/\\n|(?:^[\x00-\x20]+|[\t\n\r\x00]+)/g;this.special_attr_value_unquoted_chars=/(?:^(?:["'`]|\x00+$|$)|[\x09-\x0D >])/g;this.sensitive_html_entities=/&(?:#([xX][0-9A-Fa-f]+|\d+);?|(Tab|NewLine|colon|semi|lpar|rpar|apos|sol|comma|excl|ast|midast|ensp|emsp|thinsp);|(nbsp|amp|AMP|lt|LT|gt|GT|quot|QUOT);?)/g,this.null_value=/\x00/g;this.url=function(string){return this.uri_blacklist_protocols[this._getProtocol(this._convertSpecialChars(string))]?"#":string};this.attributes=function(string){var reg,match,url,i,matches=[],matches_on_events=[];reg=/\bon\w*\s*=\s*("([^"]*")|'[^']*'|([^'">\s]*))/gi;while((match=reg.exec(string))!==null){matches_on_events.push(match[0])}for(i in matches_on_events){string=string.replace(matches_on_events[i],"")}reg=/\b(?:href|src|url)\s*=\s*(?:"([^"]*)"|'([^']*)'|([^\s>]*))/gi;while((match=reg.exec(string))!==null){if(typeof match[1]!="undefined"){matches.push(match[1])}else if(typeof match[2]!="undefined"){matches.push(match[2])}else if(typeof match[3]!="undefined"){matches.push(match[3])}}for(i in matches){url=this.url(matches[i]);string=string.split(matches[i]).join(url)}return string};this.tags=function(string,tags){var self=this;var repeat_action=false;tags.map((function(tag){var reg=new RegExp("<"+tag+"\\b[^<]*(?:(?!<\\/"+tag+">)<[^<]*)*((<\\/"+tag+">)|>)","ig");var matchFullTag=string.match(reg);if(matchFullTag){repeat_action=true;if(matchFullTag.length===1){var matches=reg.exec(string);string=self._replaceTags(string,matches)}else{string=self._replaceTags(string,matchFullTag)}}}));if(repeat_action){string=self.tags(string,tags)}return string};this._replaceTags=function(string,matches){for(var i=0,length=matches.length;i<length;i++){string=string.replace(matches[i],"")}return string};this._getRawProtocol=function(string){string=string.split(this.uri_protocol_colon,2);return string.length===2&&string[0]?string[0]:null};this._getProtocol=function(string){string=this._getRawProtocol(string.replace(this.null_value,""));var self=this;return string?this._htmlDecode(string,this.uri_protocol_named_ref_map,this.sensitive_html_entities,(function(){return this.replace(self.uri_protocols_whitespaces,"").toLowerCase()})):null};this._getCharacter=function(num){return!isFinite(num)||num<=0||num>1114111||num===11||num>=1&&num<=8||num>=14&&num<=31||num>=127&&num<=159||num>=64976&&num<=65007||(num&65535)===65535||(num&65535)===65534?"":this._fromCodePoint(num)};this._fromCodePoint=String.fromCodePoint||function(codePoint){if(arguments.length===0){return""}if(codePoint<=65535){return String.fromCharCode(codePoint)}codePoint-=65536;return String.fromCharCode((codePoint>>10)+55296,codePoint%1024+56320)};this._convertSpecialChars=function(string){return this._stringify(string,String.prototype.replace,this.special_attr_value_unquoted_chars,(function(m){return m==="\t"?"&#9;":m==="\n"?"&#10;":m==="\v"?"&#11;":m==="\f"?"&#12;":m==="\r"?"&#13;":m===" "?"&#32;":m===">"?"&gt;":m==='"'?"&quot;":m==="'"?"&#39;":m==="`"?"&#96;":""}))};this._stringify=function(string,callback){return typeof string==="undefined"?"undefined":string===null?"null":callback.apply(string.toString(),[].splice.call(arguments,2))};this._htmlDecode=function(string,namedRefMap,reNamedRef,callback){var decodedStr,args=[].splice.call(arguments,4),self=this;return this._stringify(string,(function(){decodedStr=this.replace(this.null_value,"").replace(reNamedRef,(function(m,num,named,named1){if(num){num=Number(num[0]<="9"?num:"0"+num);return num>=55296&&num<=57343||num===13?"":self._getCharacter(num)}return namedRefMap[named||named1]||m}));return callback?callback.apply(decodedStr,args):decodedStr}))}};
