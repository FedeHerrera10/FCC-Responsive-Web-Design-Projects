"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var select=function(_CrowdinComponent){_inherits(select,_CrowdinComponent);var _super=_createSuper(select);function select(options){var _this;_classCallCheck(this,select);_this=_super.call(this);_this.is_mac=navigator.platform.toUpperCase().indexOf("MAC")>=0;_this.is_mobile=navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i);_this.$container={};_this.ns=".select";_this.options={container:"",selector:"",open_handler:"dblclick",event_namespace:"",open_fn:function open_fn(){},select_fn:function select_fn(){},drag_start_fn:function drag_start_fn(){},drag_fn:function drag_fn(){},drag_end_fn:function drag_end_fn(){},singleselect:false,smooth_scroll:true,drag:false,scroll_offset:15,keyboard_select:true,use_checkboxes:true};_this.options=$.extend({},_this.options,options);if(_this.options.event_namespace){_this.ns+="."+_this.options.event_namespace}_this.init();return _this}_createClass(select,[{key:"init",value:function init(){var self=this;var container=self.options.container;var selector=self.options.selector;var $container=self.$container=$(container);var delayed_select=[null,null];var active=false;var dragging=false;var startX=0;var startY=0;if(typeof $container.attr("tabindex")==="undefined"){$container.attr("tabindex",0)}if(this.options.event_namespace){$(document).off(this.ns);$container.off(this.ns)}$container.on("click"+this.ns,(function(e){if(e.target===$container[0]){self.disselect_all()}}));if(self.options.drag&&!self.is_mobile){$(document).on("mousemove"+this.ns,(function(e){if(active){e.preventDefault();var x_val=e.originalEvent.pageX-startX;var y_val=e.originalEvent.pageY-startY;if(Math.abs(x_val)<5&&Math.abs(y_val)<5){return}if(!dragging){self.options.drag_start_fn(startX,startY);dragging=true}self.options.drag_fn(x_val,y_val)}})).on("mouseup"+this.ns,(function(e){if(dragging){var x_val=e.originalEvent.pageX-startX;var y_val=e.originalEvent.pageY-startY;self.options.drag_end_fn(x_val,y_val)}active=false;dragging=false}))}$container.on(self.is_mobile?"click"+this.ns:"mousedown"+this.ns,selector,(function(e){if(e.target.tagName==="INPUT"&&e.target.type==="checkbox"&&self.options.use_checkboxes||e.target.tagName==="TEXTAREA"||e.button===2){return}var item=$(this);var ignored_elements=["A","BUTTON","I","INPUT"];if(ignored_elements.indexOf(e.target.tagName)===-1){active=true;startX=e.originalEvent.pageX;startY=e.originalEvent.pageY}if(!self.is_mac&&!e.ctrlKey||self.is_mac&&!e.metaKey||self.options.singleselect){if(!e.shiftKey||self.options.singleselect){if(item.hasClass("checked")&&self.options.drag&&!self.is_mobile){delayed_select=[item,"select"]}else{self.item_disselect($(selector,container),true);self.item_select(item)}}else{self.multiple_select(item);e.preventDefault()}}else{if(item.hasClass("checked")&&self.options.drag&&!self.is_mobile){delayed_select=[item,"toggle"]}else{self.item_toggle(item)}}self.update_selection()}));if(!self.is_mobile){$container.on("mouseup"+this.ns,selector,(function(e){if(delayed_select[0]){if(delayed_select[0].is(this)){var item=$(this);if(delayed_select[1]==="select"){self.item_disselect($(selector,container),true);self.item_select(item)}else{self.item_toggle(item)}self.update_selection()}delayed_select=[null,null]}}))}if(this.options.use_checkboxes){var shift_key=false;$container.on("mouseup"+this.ns+" keyup"+this.ns,'label.checkbox, input[type="checkbox"]',(function(e){shift_key=e.shiftKey?true:false}));$container.on("click"+this.ns,"label.checkbox",(function(e){e.preventDefault()}));$container.on("change"+this.ns,this.options.selector+' input[type="checkbox"]',(function(){if(!shift_key){self[this.checked?"item_select":"item_disselect"]($(this).closest(selector))}else{self.multiple_select($(this).closest(selector))}self.update_selection();self.focus_container()}))}var shift_key_2=false;if(!self.is_mobile){$container.on("mousedown"+this.ns,"textarea",(function(e){shift_key_2=e.shiftKey?true:false}))}$container.on("focus"+this.ns,"textarea",(function(){var item=$(this).closest(selector);if(!shift_key_2){self.item_disselect($(selector,container).not(item[0]),true);self.item_select(item)}else{shift_key_2=false;self.multiple_select(item)}self.update_selection()}));$(document).on("keydown"+this.ns,container,(function(e){switch(e.which){case 38:case 40:case 13:case 32:if($(this).find(":focus").length){return}var items=$(selector,container);var selected=items.filter(".check-end");if(selected.length===0){selected=items.filter(".checked:last")}break;default:return}switch(e.which){case 38:case 40:if(!self.options.keyboard_select){break}if(e.ctrlKey&&(is_mac&&crowdin.hotkeys.hotkeys_mac[crowdin.hotkeys.PREVIOUS_TRANSLATION_KEY]==="Ctrl+Up"||!is_mac&&crowdin.hotkeys.hotkeys_other[crowdin.hotkeys.PREVIOUS_TRANSLATION_KEY]==="Ctrl+Up")){break}if(e.ctrlKey&&(is_mac&&crowdin.hotkeys.hotkeys_mac[crowdin.hotkeys.NEXT_TRANSLATION_KEY]==="Ctrl+Down"||!is_mac&&crowdin.hotkeys.hotkeys_other[crowdin.hotkeys.NEXT_TRANSLATION_KEY]==="Ctrl+Down")){break}if(selected.length===0){var new_selector=selector+":"+(e.which===40?"first":"last");var new_element=$(new_selector,container);if(new_element.length){self.item_select(new_element);self.show_item_in_viewport(new_element);e.preventDefault();self.update_selection()}break}var index=items.index(selected);e.which===40?index++:index--;var element=index===-1?[]:items.eq(index);if(element.length===0){break}if(!e.shiftKey||self.options.singleselect){self.item_disselect(items,true);self.item_select(element)}else{self.multiple_select(element,true,e.which===40?"down":"up")}self.show_item_in_viewport(element);e.preventDefault();self.update_selection();break;case 13:case 32:e.preventDefault();if(selected.length){self.options.open_fn(selected)}break}}));$container.on(self.options.open_handler+this.ns,selector,(function(e){if($(e.target).is("input, select, a, button")||$(e.target).parent().is("a, button")||$container.hasClass("select-js-disable")){return}self.options.open_fn($(this));e.preventDefault()}))}},{key:"get_nodes",value:function get_nodes(match){var items=$(this.options.selector,this.options.container);return typeof match==="undefined"?items:items.filter(match)}},{key:"select",value:function select(match){var self=this;var items=$(self.options.selector,self.options.container);var selected=items.filter(match);if(selected.length){self.item_disselect(items,true);self.item_select(selected);if(!selected.find(":focus").length){self.show_item_in_viewport(selected)}}self.update_selection();return selected}},{key:"item_select",value:function item_select(elements,simple_select){var items=$(this.options.selector,this.options.container);elements.addClass("checked");if(this.options.use_checkboxes){elements.find('input[type="checkbox"]').prop("checked",true)}if(simple_select!==true){items.removeClass("check-start check-end");elements.first().addClass("check-start");elements.last().addClass("check-end")}}},{key:"item_disselect",value:function item_disselect(elements,simple_disselect){elements.removeClass("checked check-start check-end");if(this.options.use_checkboxes){elements.find('input[type="checkbox"]').prop("checked",false)}if(simple_disselect!==true){var items=$(this.options.selector,this.options.container);var items_checked=items.filter(".checked").removeClass("check-start check-end");var index=items.index(elements.last());items_checked.each((function(i){if(items.index(this)>index){$(this).addClass("check-start check-end");return false}if(items_checked.length-1===i){items_checked.last().addClass("check-start check-end")}}))}}},{key:"item_toggle",value:function item_toggle(elements){var self=this;elements.each((function(){if($(this).hasClass("checked")){self.item_disselect($(this))}else{self.item_select($(this))}}))}},{key:"multiple_select",value:function multiple_select(item,keyboard_select,key_direction){var self=this;var container=self.options.container;var selector=self.options.selector;var is_checked=item.hasClass("checked")?true:false;var items=$(selector,container);var items_reversed=$(items.get().reverse());var item_to=items.filter(".check-start");var index_from=items.index(item);var index_to=items.index(item_to);if(index_to===-1){item_to=items.first().addClass("check-start");index_to=0}var direction=index_from>index_to?"down":index_from<index_to?"up":"none";function go_prevs(_items){var skip=true;_items.each((function(){if(this===item_to[0]){skip=false;return true}if(skip){return true}if($(this).hasClass("checked")){self.item_disselect($(this),true)}else{return false}}))}function go_forth(_items){var skip=true;_items.each((function(){if(this===item[0]){skip=false;return true}if(skip){return true}if($(this).hasClass("checked")){if(keyboard_select&&key_direction===direction){index_from=items.index(this)}else if(is_checked){self.item_disselect($(this),true)}}else{return false}}))}go_forth(direction==="up"?items_reversed:items);direction!=="down"&&go_prevs(items);direction!=="up"&&go_prevs(items_reversed);items.removeClass("check-end").eq(index_from).addClass("check-end");if(direction==="down"){index_to=[index_from,index_from=index_to][0]}for(var index=index_from;index<=index_to;index++){self.item_select(items.eq(index),true)}}},{key:"select_all",value:function select_all(){var self=this;self.item_select($(self.options.selector,self.options.container));self.update_selection()}},{key:"disselect_all",value:function disselect_all(){var self=this;self.item_disselect($(self.options.selector,self.options.container),true);self.update_selection()}},{key:"get_selected_items",value:function get_selected_items(){return $(this.options.container).find(this.options.selector).filter(".checked")}},{key:"update_selection",value:function update_selection(){var selected=this.get_selected_items();this.options.select_fn(selected)}},{key:"show_item_in_viewport",value:function show_item_in_viewport(elem){if(!$(elem).length){return}var offset=this.options.scroll_offset;var container=this.$container;var offset_fn="position";var overflow=container.css("overflow-y");var is_window_container=overflow!=="auto"&&overflow!=="scroll";if(is_window_container){container=$(window);offset_fn="offset"}var c_height=container.outerHeight();var docViewTop=container.scrollTop();var docViewBottom=docViewTop+c_height;var scroll_val=0;var scroll_diff=0;var elemTop=$(elem)[offset_fn]().top+(is_window_container?0:docViewTop);var elemBottom=elemTop+$(elem).outerHeight();if(elemBottom>docViewBottom||elemTop<docViewTop){if(elemTop<docViewTop){scroll_val=elemTop-offset}else{scroll_val=docViewTop+elemBottom-docViewBottom+offset}if(is_window_container){container=$(document.documentElement)}if(this.options.smooth_scroll){scroll_diff=Math.abs(docViewTop-scroll_val)*.7;container.stop().animate({scrollTop:scroll_val},Math.min(scroll_diff,500))}else{container.scrollTop(scroll_val)}}}},{key:"focus_container",value:function focus_container(){var x=window.scrollX||window.pageXOffset,y=window.scrollY||window.pageYOffset;this.$container.focus();window.scrollTo(x,y)}}]);return select}(CrowdinComponent);
