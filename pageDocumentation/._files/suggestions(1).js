"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var SuggestionsView=function(_React$Component){_inherits(SuggestionsView,_React$Component);var _super=_createSuper(SuggestionsView);function SuggestionsView(props){var _this;_classCallCheck(this,SuggestionsView);_this=_super.call(this,props);_this.PROVIDER_TM=1;_this.PROVIDER_GOOGLE=2;_this.PROVIDER_BING=3;_this.PROVIDER_YANDEX=5;_this.PROVIDER_CROWDIN=6;_this.PROVIDER_DEEPL=7;_this.PROVIDER_AMAZON=8;_this.PROVIDER_WATSON=9;_this.PROVIDER_GOOGLE_AUTOML=11;_this.PROVIDER_PT_TM=1001;_this.PROVIDER_PT_GOOGLE=1002;_this.PROVIDER_PT_BING=1003;_this.PROVIDER_PT_YANDEX=1005;_this.PROVIDER_PT_CROWDIN=1006;_this.PROVIDER_PT_DEEPL=1007;_this.PROVIDER_PT_AMAZON=1008;_this.PROVIDER_PT_WATSON=1009;_this.PROVIDER_PT_GOOGLE_AUTOML=1011;_this.hasTmMtSuggestions=0;_this.autocompleteLoadTimeout=null;return _this}_createClass(SuggestionsView,[{key:"getAssetType",value:function getAssetType(){var x="";if(window.devicePixelRatio>1){x="@2x";if(window.devicePixelRatio>2){x="@3x"}}return x}},{key:"componentDidMount",value:function componentDidMount(){crowdin.models.phrases.on("changed.suggestions",this.phrasesChanged);crowdin.models.external_suggestions&&crowdin.models.external_suggestions.on("load",this.phrasesChanged);if(crowdin.models.mt){crowdin.models.mt.on("load",this.phrasesChanged);crowdin.models.mt.on("loadTmSuggestions",this.tmSuggestionsLoaded)}}},{key:"componentWillUnmount",value:function componentWillUnmount(){crowdin.models.phrases.off("changed.suggestions",this.phrasesChanged);crowdin.models.external_suggestions&&crowdin.models.external_suggestions.off("load",this.phrasesChanged);if(crowdin.models.mt){crowdin.models.mt.off("load",this.phrasesChanged);crowdin.models.mt.off("loadTmSuggestions",this.tmSuggestionsLoaded)}}},{key:"tmSuggestionsLoaded",value:function tmSuggestionsLoaded(id){if(crowdin.translation.translation_id===id){clearTimeout(this.autocompleteLoadTimeout);this.autocompleteLoadTimeout=setTimeout((function(){crowdin.suggestions.refreshAutocomplete()}),500)}}},{key:"phrasesChanged",value:function phrasesChanged(id){if(crowdin.translation.translation_id===id){crowdin.suggestions.refresh()}}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){$(ReactDOM.findDOMNode(this)).find(".suggestion-time").momentlive();if(prevProps.targetLanguageId&&this.props.targetLanguageId&&crowdin.editor.modeProofread()){if(prevProps.targetLanguageId!==this.props.targetLanguageId){crowdin.models.phrases.refresh(crowdin.translation.translation_id)}}}},{key:"render",value:function render(){this.hasTmMtSuggestions=0;var _this$props=this.props,tms=_this$props.tms,mts=_this$props.mts,tmAndMtSuggestionsLoaded=_this$props.tmAndMtSuggestionsLoaded;this._clearSuggestionTexts();var isVisibleSuggestions=crowdin.suggestions&&crowdin.suggestions.show_suggestions&&crowdin.editor.target_language;var isVisibleExternalSuggestions=crowdin.suggestions&&crowdin.suggestions.show_external_suggestions&&crowdin.editor.target_language;var isVisibleTMMT=crowdin.suggestions&&crowdin.suggestions.show_tm_mt&&crowdin.editor.target_language;var tmMtTemplates=isVisibleTMMT?["div",this.tmSuggestions(),this.mtSuggestions(),this.noMtSuggestions()]:null;var emptyTmAndMtSuggestions=!(tms||[]).length&&!Object.values(mts||{}).length;if(!tmAndMtSuggestionsLoaded&&crowdin.editor.modeReviewProofread()){emptyTmAndMtSuggestions=true}if(emptyTmAndMtSuggestions&&!tmAndMtSuggestionsLoaded&&!crowdin.editor.modeAssets()){tmMtTemplates=this.loadingTpl()}return ReactCompile(["div#suggestions.suggestions-list",this.suggestionsTitle(),isVisibleSuggestions?["div",this.suggestionsTpl()]:null,this.externalSuggestionSeparatorTpl(),isVisibleExternalSuggestions?["div",this.externalSuggestions()]:null,this.suggestionSeparatorTpl(),tmMtTemplates])}},{key:"loadingTpl",value:function loadingTpl(){return crowdin.editor.target_language?["div.no_suggestions_yet",_l("generic.loadingD")]:null}},{key:"suggestionsTitle",value:function suggestionsTitle(){if(crowdin.editor.modeAssets()){return null}var itemTitle=_l("editor.humanTranslations");if(crowdin.editor.modeTranslateProofread()){var targetLanguageName=crowdin.editor.target_language&&crowdin.editor.target_language.name;if(targetLanguageName){itemTitle=_l("editorMenu.languageTranslations",{language:targetLanguageName})}}if(crowdin.editor.modeReview()){itemTitle=_l("editor.stringCorrections")}var isVisibleSuggestions=crowdin.suggestions&&crowdin.suggestions.show_suggestions;return["div.suggestions_separator",["a.toggle "+(isVisibleSuggestions?"active":""),{id:"suggestions-toggler",href:"#",tabIndex:-1},itemTitle]]}},{key:"suggestionsTpl",value:function suggestionsTpl(){var self=this;var text_direction="ltr";var lang_code="";if(crowdin.editor.target_language){text_direction=crowdin.editor.target_language.text_direction;lang_code=crowdin.editor.target_language.generic_code}if(!this.props.suggestionsLoaded){return this.loadingTpl()}if(this.props.suggestions.length===0){return["div.no_suggestions_yet",_l("editor.noSuggestionsYet")]}if(crowdin.editor.modeAssets()){return this.suggestionAssetTpl()}else{return this.suggestionTextTpl(lang_code,text_direction)}}},{key:"suggestionTextTpl",value:function suggestionTextTpl(lang_code,text_direction){var result=[];var suggestions=_toConsumableArray(this.props.suggestions);var translation=crowdin.translation.get_translation();if(+translation.duplicate_of){var translationHasOwnSuggestions=this.props.suggestions.findIndex((function(i){return+i.translation_id===+translation.id}))!==-1;if(translationHasOwnSuggestions){suggestions=suggestions.filter((function(i){return+i.translation_id===+translation.id}))}}for(var i=0;i<suggestions.length;i++){var item=suggestions[i];if(item.deleted){result.push(["div",{key:item.id,className:"clearfix direction-"+text_direction},["div.main-block",["div.suggestion-logo-wrapper"],["div.suggestion-text-wrapper muted",_l("editor.translationDeleted")+" ",["a",{href:"#","data-id":item.id,"data-activity-id":item.delete_activity_id,className:"suggestion-restore"},_l("generic.undo")]]]])}else{this._storeSuggestionText(crowdin.suggestions.prepareText(item.text),"default");result.push(["div",{"data-id":item.id,key:item.id,lang:lang_code,className:"suggestion clearfix direction-"+text_direction},["div.main-block",["div.suggestion-logo-wrapper",["img.user-avatar",{src:item.user.avatar_url}],item.provider>0?["img.user-avatar-mt",{src:this.providerIcon(item),title:this.providerMsg(item),style:{width:"12px"}}]:null],["div.suggestion-text-wrapper",this.actionsBlock(item),this.textAndAuthor(item)]]])}}return result}},{key:"suggestionAssetTpl",value:function suggestionAssetTpl(){var result=[];for(var i=0;i<this.props.suggestions.length;i++){var item=this.props.suggestions[i];if(item.deleted){result.push(["div",{key:item.id,className:"unselectable clearfix"},["div.main-block",["div.suggestion-preview-img center pull-left",{style:{width:"128px"}}],["div.asset-suggestion-details muted",_l("editor.translationDeleted")+" ",["a",{href:"#","data-id":item.id,"data-activity-id":item.delete_activity_id,className:"suggestion-restore"},_l("generic.undo")]]]])}else{result.push(["div.suggestion unselectable clearfix",{"data-id":item.id,key:item.id},["div.suggestion-preview-img center pull-left",{style:{width:IS_MOBILE?"64px":"128px"}},item.preview_available?["img",{src:crowdin.editor.view.getSuggestionSrc(item.id)+"&preview=1",style:{maxWidth:"100%",maxHeight:IS_MOBILE?"64px":"128px"}}]:["i.file-type-64-"+crowdin.editor.view.state.translation.ext]],["div.asset-suggestion-details",["div.main-block clearfix",["div.asset-logo-wrapper pull-left",["img.user-avatar",{src:item.user.avatar_url,style:{width:"34px",height:"34px"}}]],this.actionsBlock(item),this.textAndAuthor(item)],this.actionsPane(item)]])}}return result}},{key:"actionsBlock",value:function actionsBlock(item){var self=this;if(IS_MOBILE){return null}return["div.actions-block",!crowdin.editor.modeReview()?self.actionsRatingTpl(item):null,["div.suggestion-actions",["div.btn-toolbar no-margin",self.actionsApproveTpl(item),!crowdin.editor.modeReview()?self.actionsVoteUpTpl(item):null,!crowdin.editor.modeReview()?self.actionsVoteDownTpl(item):null,self.actionsDeleteTpl(item),!crowdin.editor.modeAssets()?self.actionMoreTpl(item):null]]]}},{key:"tmActionsBlock",value:function tmActionsBlock(item){if(IS_MOBILE){return null}return["div.actions-block",["div.suggestion-actions",["div.btn-toolbar no-margin suggestions-visible-hover",crowdin.editor.isAvailableRepairTmSuggestion()&&item.relevant&&item.relevant<100&&!item.raw_text?["button.btn btn-icon repair-action",{title:_l("editor.repairTmSuggestion"),tabIndex:"-1",disabled:false,onClick:function onClick(e){crowdin.suggestions.repairTmSuggestion(item.uid);e.preventDefault()}},["i.static-icon static-icon-wand"]]:null,item.raw_text?["button.btn btn-icon undo-repair-action",{title:_l("editor.undoRepairedTmSuggestion"),tabIndex:"-1",disabled:false,onClick:function onClick(e){crowdin.suggestions.undoRepairedTmSuggestion(item.uid);e.preventDefault()}},["i.static-icon static-icon-undo"]]:null,["button.btn btn-icon use-and-save-action",{title:_l("editor.useAndSave"),tabIndex:"-1",disabled:false},["i.static-icon static-icon-save"]]]]]}},{key:"textAndAuthor",value:function textAndAuthor(item){return["div.suggestion-text-and-author",!crowdin.editor.modeAssets()?["div.suggestion-text"+(crowdin.suggestions&&crowdin.suggestions.suggestions_select_mode?" selectable":""),crowdin.suggestions.prepareText(item.text)]:null,this.suggestionContributorInfoTpl(item),IS_MOBILE?["div.approve-author",{style:{marginTop:"3px"}},_l("editor.rating2D",{rating:item.rating})]:null]}},{key:"actionsRatingTpl",value:function actionsRatingTpl(item){return["div.suggestion-rating "+(item.rating>0?"positive":item.rating<0?"negative":""),crowdin.suggestions.is_approved(item)&&!crowdin.user.is_leader?["i.static-icon static-icon-green-check",{title:_l("editor.approvedTranslation"),style:{marginRight:"9px"}}]:null,["span",{title:_l("editor.rating")+": "+item.rating},item.rating]]}},{key:"actionsApproveTpl",value:function actionsApproveTpl(item){if(!crowdin.editor.approvingAvailable()){return null}var validation=this._get_validation(item);return["button",{tabIndex:"-1",className:"approve-action btn btn-icon "+(validation.approved?"active":""),title:validation.approved?_l("editor.disapproveHotkey",{hotkey:crowdin.hotkeys.get(crowdin.hotkeys.DISAPPROVE_KEY)}):_l("editor.approveHotkey",{hotkey:crowdin.hotkeys.get(crowdin.hotkeys.APPROVE_KEY)})},["i.static-icon static-icon-check"]]}},{key:"actionsVoteUpTpl",value:function actionsVoteUpTpl(item){if(item.user.id===crowdin.user.id||crowdin.editor.approvingAvailable()){return null}return["button",{tabIndex:"-1",title:_l("editor.voteUpHotkey",{hotkey:crowdin.hotkeys.get(crowdin.hotkeys.VOTE_PLUS_KEY)}),className:"active-suggestion-plus-button btn btn-icon "+(item.votes[crowdin.user.id]==="1"?"active":"")},["i.static-icon static-icon-plus"]]}},{key:"actionsVoteDownTpl",value:function actionsVoteDownTpl(item){if(item.user.id===crowdin.user.id||crowdin.editor.approvingAvailable()){return null}return["button",{tabIndex:"-1",title:_l("editor.voteDownHotkey",{hotkey:crowdin.hotkeys.get(crowdin.hotkeys.VOTE_MINUS_KEY)}),className:"active-suggestion-minus-button btn btn-icon "+(item.votes[crowdin.user.id]==="-1"?"active":"")},["i.static-icon static-icon-minus"]]}},{key:"actionsDeleteTpl",value:function actionsDeleteTpl(item){if(crowdin.user.is_leader||item.user.id===crowdin.user.id){var is_deletable=crowdin.suggestions.is_deletable(item);var title=is_deletable?_l("editor.deleteSuggestedTranslation"):_l("editor.cantDeleteTranslation");return["button.active_suggestion_delete_button btn btn-icon",{title:title,tabIndex:"-1",disabled:!is_deletable},["i.static-icon static-icon-trash"]]}return null}},{key:"actionMoreTpl",value:function actionMoreTpl(item){var report_abuse=this.reportAbuseBtn(item,true);var discuss_approval=this.discussApprovalBtn(item,true);return["div.btn-group suggestions-visible-hover",["button.btn btn-icon dropdown-toggle",{style:{padding:"5px 0"},tabIndex:-1,"data-toggle":"dropdown",disabled:!report_abuse&&!discuss_approval},["i.static-icon static-icon-dots-v"]],["ul.dropdown-menu dropdown-menu-small"+(crowdin.editor.target_language.text_direction==="ltr"?" pull-right":""),report_abuse,discuss_approval]]}},{key:"reportAbuseBtn",value:function reportAbuseBtn(item,actionMore){var was_reported=item.abuses.indexOf(crowdin.user.id)>-1;if(!crowdin.user.is_leader&&item.user.id!==crowdin.user.id){var button=["a.report_abuse_action"+(!actionMore?" pull-left":""),{href:"#",tabIndex:"-1"},!was_reported?_l("editor.reportAbuse"):_l("editor.notAbuse")];return["li"+(!actionMore?".pull-left inline-block":""),button]}return null}},{key:"discussApprovalBtn",value:function discussApprovalBtn(item,actionMore){var validation=this._get_validation(item);if(validation.approved&&validation.approver.id!==crowdin.user.id){var button=["a.discuss_approval_action",{href:"#",tabIndex:"-1","data-user":validation.approver.login},_l("editor.discussApproval")];return["li"+(!actionMore?".pull-left inline-block":""),button]}return null}},{key:"externalSuggestionSeparatorTpl",value:function externalSuggestionSeparatorTpl(){if(!crowdin.editor.project.use_external_suggestions||crowdin.editor.modeAssets()){return null}var isVisibleExternalSuggestions=crowdin.suggestions&&crowdin.suggestions.show_external_suggestions;return["div.suggestions_separator clearfix",["a.toggle "+(isVisibleExternalSuggestions?"active":""),{id:"external-suggestions-toggler",href:"#",tabIndex:-1},_l("editor.externalSuggestions")]]}},{key:"suggestionSeparatorTpl",value:function suggestionSeparatorTpl(){if(crowdin.editor.modeAssets()){return null}var isVisibleTMMT=crowdin.suggestions&&crowdin.suggestions.show_tm_mt;var titleToggle=crowdin.editor.modeReview()?_l("editor.TMAndMTCorrections"):_l("editor.TMAndMTSuggestions");var textToggle=crowdin.editor.modeReview()?_l("editor.TMAndMTCorrectionsShort"):_l("editor.TMAndMTSuggestionsShort");return["div.suggestions_separator clearfix",this.noMtWarning(),["a.toggle "+(isVisibleTMMT?"active":""),{id:"tm-mt-toggler",href:"#",tabIndex:-1,title:titleToggle},textToggle]]}},{key:"noMtWarning",value:function noMtWarning(){if(!window.IS_MT_ALLOWED||crowdin.editor.modeReview()){return null}if(window.BING_TRANSLATE_ENABLED||window.GOOGLE_TRANSLATE_ENABLED||window.GOOGLE_AUTOML_TRANSLATE_ENABLED||window.DEEPL_TRANSLATE_ENABLED||window.WATSON_TRANSLATOR_ENABLED||window.AMAZON_TRANSLATE_ENABLED||window.YANDEX_TRANSLATE_ENABLED||window.CROWDIN_TRANSLATE_ENABLED){return null}return["span.label label-warning pull-right",{title:_l("editor.MTNotConfigured"),style:{cursor:"help",marginTop:"2px"}},_l("editor.MT")]}},{key:"noMtSuggestions",value:function noMtSuggestions(){if(!this.hasTmMtSuggestions){return["div.no_suggestions_yet",_l("editor.noSuggestions")]}return null}},{key:"mtSuggestionTpl",value:function mtSuggestionTpl(suggestion){var attributes={className:"suggestion clearfix direction-"+crowdin.editor.target_language.text_direction,lang:crowdin.editor.target_language.generic_code,"data-provider":suggestion.provider,"data-provider-name":suggestion.provider_name,"data-provider-id":suggestion.provider_id,"data-uid":suggestion.uid,key:suggestion.uid};this._storeSuggestionText(suggestion.text,"mt");return["div",attributes,["div.main-block",["div.suggestion-logo-wrapper",["img",{src:suggestion.logo,style:{width:"24px"}}]],["div.suggestion-text-wrapper",this.tmActionsBlock(suggestion),["div.suggestion-text-and-author",["div.suggestion-text"+(crowdin.suggestions&&crowdin.suggestions.suggestions_select_mode?" selectable":""),["div.suggestion_tm_translation",suggestion.text]],suggestion.relevant&&suggestion.relevant<100?["div.suggestion_tm_source",{innerHTML:suggestion.source_html}]:null,["div.suggestion-author machine-translation-author",["nobr",suggestion.user,suggestion.uid.indexOf("crowdin")!==-1&&suggestion.score>=7?["span.suggestion-nmt-verified",{title:_l("editor.highRelevantSuggestion")}]:null,suggestion.raw_text?["span.tm-suggestion-repaired",{title:_l("editor.repairedTmSuggestion")}]:null],suggestion.match&&!suggestion.raw_text?["span.suggestion_relevant",", ",["nobr",suggestion.match],suggestion.updated_at?["span",", ",["span",{innerHTML:'<span class="suggestion-time" data-timeformat="'.concat(TIME_AM_PM?"hh:mm A":"HH:mm",'" data-datetime="').concat(htmlspecialchars(suggestion.updated_at),'"></span>')}]]:null]:null],this.getTmLanguagesInfoTpl(suggestion)]]]]}},{key:"getTmLanguagesInfoTpl",value:function getTmLanguagesInfoTpl(suggestion){if(!suggestion.source_language||!suggestion.target_language||crowdin.editor.modeReview()){return null}if(suggestion.source_language.id!=crowdin.editor.source_language.id||suggestion.target_language.id!=crowdin.editor.target_language.id){var tmSourceLanguageName=crowdin.language.languages[suggestion.source_language.id].name;var tmTargetLanguageName=crowdin.language.languages[suggestion.target_language.id].name;return["div.suggestion_tm_language",["span",tmSourceLanguageName]," â†’ ",["span",tmTargetLanguageName]]}}},{key:"externalSuggestions",value:function externalSuggestions(){if(!crowdin.editor.project.use_external_suggestions){return null}if(!this.props.suggestionsLoaded){return this.loadingTpl()}var text_direction="ltr";var lang_code="";if(crowdin.editor.target_language){text_direction=crowdin.editor.target_language.text_direction;lang_code=crowdin.editor.target_language.generic_code}if(this.props.externalSuggestions.length===0){return["div.no_suggestions_yet",_l("editor.noSuggestions")]}return this.externalSuggestionTextTpl(lang_code,text_direction)}},{key:"externalSuggestionTextTpl",value:function externalSuggestionTextTpl(lang_code,text_direction){var result=[];var suggestions=this.props.externalSuggestions;for(var i=0;i<suggestions.length;i++){var item=suggestions[i];this._storeSuggestionText(crowdin.suggestions.prepareText(item.text),"external");result.push(["div",{"data-id":item.id,key:item.id,lang:lang_code,className:"suggestion clearfix direction-"+text_direction},["div.main-block",["div.suggestion-logo-wrapper",["img.user-avatar",{src:item.user.avatar_url}]],["div.suggestion-text-wrapper",this.textAndAuthor(item)]]])}return result}},{key:"tmSuggestions",value:function tmSuggestions(){var self=this;return this.props.tms.map((function(suggestion){self.hasTmMtSuggestions=1;return self.mtSuggestionTpl({uid:suggestion.uid,provider:suggestion.provider_type,provider_id:suggestion.provider_id,relevant:suggestion.relevant,logo:CDN+"/crowdin-editor/public/assets/logo/crowdin"+self.getAssetType()+".png",match:suggestion.match,source_html:crowdin.suggestions.prepareText(suggestion.source_html,true),text:crowdin.suggestions.prepareText(suggestion.translation),raw_text:suggestion.raw_translation,user:suggestion.tm,source_language:suggestion.source_language,target_language:suggestion.target_language,updated_at:suggestion.updated_at})}))}},{key:"mtSuggestions",value:function mtSuggestions(){var mtSuggestions=[];var crowdinSuggestionsCount=0;for(var mtProvider in this.props.mts){if(mtProvider.indexOf("crowdin")!==-1){crowdinSuggestionsCount++}}for(var provider in crowdin.models.mt.getProviders()){if(provider==="crowdin"){for(var i=0;i<crowdinSuggestionsCount;i++){if(this.props.mts[provider+i]){mtSuggestions.push(this.mtSuggestion(this.props.mts[provider+i],i));this.hasTmMtSuggestions=1}}}else{if(this.props.mts[provider]){mtSuggestions.push(this.mtSuggestion(this.props.mts[provider],""));this.hasTmMtSuggestions=1}}}return mtSuggestions}},{key:"mtSuggestion",value:function mtSuggestion(provider,index){var ext=".png";var providerData=crowdin.models.mt.getProvider(provider.provider_name);var user=["span",providerData["user"]];if(provider.provider_name=="yandex"&&!IS_MOBILE){user=["span",{style:{whiteSpace:"normal"}},_l("generic.poweredBy"),["a",{href:"http://translate.yandex.com/",tabIndex:"-1",target:"_blank"},_l("generic.yandexTranslate")]]}return this.mtSuggestionTpl({provider:provider.provider_type,provider_name:provider.provider_name,provider_id:provider.provider_id,logo:CDN+"/crowdin-editor/public/assets/logo/"+providerData["logo"]+this.getAssetType()+ext,user:user,text:provider.translation,raw_text:provider.raw_translation,uid:provider.provider_name+index,score:+provider.score||0})}},{key:"actionsPane",value:function actionsPane(item){var action=crowdin.suggestions.is_approved(item)?this.discussApprovalBtn(item):this.reportAbuseBtn(item);var download=["div.download-suggestion pull-left",action?["span",{style:{color:"#ddd"},innerHTML:"&nbsp;&nbsp&bull;&nbsp;&nbsp"}]:null,["a",{tabIndex:"-1",href:crowdin.editor.view.getSuggestionSrc(item.id)},_l("generic.download")],["span",{style:{color:"#ddd"},innerHTML:"&nbsp;&nbsp&bull;&nbsp;&nbsp"}],["span.muted",item.filesize]];return IS_MOBILE?["div.status-block"]:["div.status-block clearfix",action,download,crowdin.editor.view.state.suggestion_id===item.id?["div.preview-indicator pull-right",["i.static-icon"]]:null]}},{key:"providerIcon",value:function providerIcon(suggestion){var icon="icon-tm";var x=this.getAssetType();switch(parseInt(suggestion.provider)){case this.PROVIDER_TM:case this.PROVIDER_PT_TM:icon="icon-tm";break;case this.PROVIDER_GOOGLE:case this.PROVIDER_PT_GOOGLE:icon="icon-google-transalte";break;case this.PROVIDER_GOOGLE_AUTOML:case this.PROVIDER_PT_GOOGLE_AUTOML:icon="icon-google-automl-transalte";break;case this.PROVIDER_DEEPL:case this.PROVIDER_PT_DEEPL:icon="icon-deepl-translator";break;case this.PROVIDER_WATSON:case this.PROVIDER_PT_WATSON:icon="icon-watson-translator";break;case this.PROVIDER_AMAZON:case this.PROVIDER_PT_AMAZON:icon="icon-amazon-translate";break;case this.PROVIDER_BING:case this.PROVIDER_PT_BING:icon="icon-microsoft-translator";break;case this.PROVIDER_YANDEX:case this.PROVIDER_PT_YANDEX:icon="icon-yandex";break;case this.PROVIDER_CROWDIN:case this.PROVIDER_PT_CROWDIN:icon="icon-crowdin-translate";break}return CDN+"/crowdin-editor/public/assets/"+icon+x+".png"}},{key:"providerMsg",value:function providerMsg(suggestion){var provider=_l("generic.machineTranslation");var validation=this._get_validation(suggestion);switch(parseInt(suggestion.provider)){case this.PROVIDER_TM:case this.PROVIDER_PT_TM:provider=_l("generic.translationMemory");break;case this.PROVIDER_GOOGLE:case this.PROVIDER_PT_GOOGLE:provider=_l("generic.googleTranslate");break;case this.PROVIDER_AMAZON:case this.PROVIDER_PT_AMAZON:provider=_l("generic.amazonTranslate");break;case this.PROVIDER_DEEPL:case this.PROVIDER_PT_DEEPL:provider=_l("generic.deeplTranslator");break;case this.PROVIDER_WATSON:case this.PROVIDER_PT_WATSON:provider=_l("generic.watsonTranslator");break;case this.PROVIDER_BING:case this.PROVIDER_PT_BING:provider=_l("generic.microsoftTranslator");break;case this.PROVIDER_YANDEX:case this.PROVIDER_PT_YANDEX:provider=_l("generic.yandexTranslate");break;case this.PROVIDER_CROWDIN:case this.PROVIDER_PT_CROWDIN:provider=_l("generic.crowdinTranslate");break}var msg=_l("editor.machineTranslationAttention",{provider:provider,user:crowdin.user.get_full_name(suggestion.user)});if(!validation.approved){msg=_l("editor.needsReviewE")+" "+msg}return msg}},{key:"_get_validation",value:function _get_validation(item){var stepId=crowdin.editor.workflow_step.id||crowdin.user.get_workflow_proofread_step_id();return item.validations[stepId]||{approved:false}}},{key:"_storeSuggestionText",value:function _storeSuggestionText(text,type){var _crowdin$translation=crowdin.translation,suggestion_texts=_crowdin$translation.suggestion_texts,suggestionTextsSorted=_crowdin$translation.suggestionTextsSorted;suggestion_texts&&suggestion_texts.push(text);if(suggestionTextsSorted.hasOwnProperty(type)){suggestionTextsSorted[type].push(text)}else{suggestionTextsSorted[type]=[];suggestionTextsSorted[type].push(text)}}},{key:"_clearSuggestionTexts",value:function _clearSuggestionTexts(){if(crowdin.translation){crowdin.translation.suggestion_texts=[];crowdin.translation.suggestionTextsSorted={}}}},{key:"suggestionContributorInfoTpl",value:function suggestionContributorInfoTpl(suggestion){var result=[];var approvals=[];var validationMark='<div class="suggestion-approved" title="'.concat(_l("editor.approved"),'"></div>');result.push(["div.suggestion-author",{key:"author"+suggestion.id,innerHTML:this.getSuggestionAuthor(suggestion)}]);if(crowdin.editor.project.has_advanced_workflow||crowdin.editor.project.has_basic_workflow){var validations=crowdin.editor.project.has_basic_workflow?this.extendValidationsWithStepNames(suggestion.validations):suggestion.validations;for(var workflowStepId in validations){var validation=validations[workflowStepId];if(validation.approved){var html=validationMark;html+=this.getApproveAuthor(validation,workflowStepId);approvals.push(["div.approved-on-step",{key:"approver"+workflowStepId,innerHTML:html}])}}}else{var _validation=this._get_validation(suggestion);if(_validation.approved){var _html=validationMark;_html+=this.getApproveAuthor(_validation);approvals.push(["div.approve-author text-overflow",{key:"approver"+suggestion.id,innerHTML:_html}])}}if(approvals.length){result.push(["div",{key:"approvals"+suggestion.id,style:{marginTop:"3px"}},approvals])}return result}},{key:"extendValidationsWithStepNames",value:function extendValidationsWithStepNames(validations){return _.map(validations,(function(step,proofreadStepId){if(!step.approved){return step}step.stepName=crowdin.editor.workflow_proofread_steps.filter((function(proofreadStep){return proofreadStepId==proofreadStep.id}))[0].name;return step}))}},{key:"getSuggestionAuthor",value:function getSuggestionAuthor(suggestion){var stepInfo=this.getWorkflowStepInfo(suggestion.workflow_step_id);var datetime='<span class="suggestion-time" data-timeformat="'+(TIME_AM_PM?"hh:mm A":"HH:mm")+'" data-datetime="'+htmlspecialchars(suggestion.date_iso)+'"></span>';var user=this.generateLink(suggestion.user);if(stepInfo.length){return crowdin.editor.modeReview()?_l("editor.correctedDateByUserOnStep",{date:datetime,user:user,step:stepInfo}):_l("editor.translatedDateByUserOnStep",{date:datetime,user:user,step:stepInfo})}else{return crowdin.editor.modeReview()?_l("editor.correctedDateByUser",{date:datetime,user:user}):_l("editor.translatedDateByUser",{date:datetime,user:user})}}},{key:"getApproveAuthor",value:function getApproveAuthor(validation,workflowStepId){var stepInfo=this.getWorkflowStepInfo(workflowStepId);var datetime='<span class="suggestion-time" data-timeformat="'.concat(TIME_AM_PM?"hh:mm A":"HH:mm",'" data-datetime="').concat(validation.approved_date_iso,'"></span>');var user=this.generateLink(validation.approver);if(stepInfo.length){return _l("editor.approvedDateByUserOnStep",{date:datetime,user:user,step:stepInfo})}if(crowdin.editor.project.has_basic_workflow){return _l("editor.approvedDateByUserOnStep",{date:datetime,user:user,step:validation.stepName})}return _l("editor.approvedDateByUser",{date:datetime,user:user})}},{key:"generateLink",value:function generateLink(user){var content='<span class="author-name">'+htmlspecialchars(crowdin.user.get_full_name(user))+"</span>";if(user.login===REMOVED_USER_LOGIN){return content}return'<a class="user-info" href="#" data-id="'+user.id+'">'+content+"</a>"}},{key:"getWorkflowStepInfo",value:function getWorkflowStepInfo(workflowStepId){var stepEditorUri;var workflowStepLink="";var workflowSteps=crowdin.editor.workflow_steps;for(var key=0;key<workflowSteps.length;key++){if(+workflowSteps[key].id===+workflowStepId){workflowStepLink=htmlspecialchars(workflowSteps[key].title);if(+workflowStepId!==+crowdin.editor.workflow_step.id){stepEditorUri=crowdin.helpers.url.buildEditorPath({workflow_step_id:workflowStepId,options:{hash:crowdin.translation.translation_id}});workflowStepLink='<a target="_blank" href="'+stepEditorUri+'">'+workflowStepLink+"</a>"}break}}return workflowStepLink}}]);return SuggestionsView}(React.Component);
