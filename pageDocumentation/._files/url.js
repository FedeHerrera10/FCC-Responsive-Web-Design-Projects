"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var crowdin_url_helper=function(){function crowdin_url_helper(){_classCallCheck(this,crowdin_url_helper);this.editorPathMapping={mode:1,project_identifier:2,file_id:3,language_id:4,workflow_step_id:5}}_createClass(crowdin_url_helper,[{key:"getEditorInfo",value:function getEditorInfo(){var items=this.getPathElements();var language=items[this.editorPathMapping.language_id]?items[this.editorPathMapping.language_id].split("-"):[];return{mode:items[this.editorPathMapping.mode],projectIdentifier:items[this.editorPathMapping.project_identifier],fileId:items[this.editorPathMapping.file_id],language:{source:language[0]||"",target:language[1]||"",toString:function toString(){return language[0]&&language[1]?language[0]+"-"+language[1]:""}},workflowStepId:items[this.editorPathMapping.workflow_step_id]||null,toUrl:function toUrl(){var info=crowdin.helpers.url.getEditorInfo();var pathElementsOrdered={mode:info.mode,project_identifier:info.projectIdentifier,file_id:info.fileId||null,language_id:info.language.toString()||null,workflow_step_id:info.workflowStepId||null};var result=[];for(var j in pathElementsOrdered){if(pathElementsOrdered[j]){result.push(pathElementsOrdered[j])}else{break}}var url="/"+result.join("/");url=crowdin.helpers.url.preserveSearchParams(url);url=crowdin.helpers.url.preserveHashParams(url);return url}}}},{key:"buildEditorPath",value:function buildEditorPath(itemsToUpdate){itemsToUpdate=itemsToUpdate||{};var sourceLanguage=crowdin.editor.source_language&&crowdin.editor.source_language.internal_code||null;var targetLanguage=crowdin.editor.target_language&&crowdin.editor.target_language.internal_code||null;var pathElementsOrdered={mode:crowdin.editor.mode,project_identifier:crowdin.editor.project.identifier,file_id:crowdin.editor.file&&crowdin.editor.file.id||null,language_id:sourceLanguage&&targetLanguage?sourceLanguage+"-"+targetLanguage:null,workflow_step_id:crowdin.editor.workflow_step.id||null};var options={hash:itemsToUpdate.options&&itemsToUpdate.options.hash||"",preserve_search_query:itemsToUpdate.options&&typeof itemsToUpdate.options.preserve_search_query!=="undefined"?itemsToUpdate.options.preserve_search_query:true,preserve_hash:itemsToUpdate.options&&typeof itemsToUpdate.options.preserve_hash!=="undefined"?itemsToUpdate.options.preserve_hash:true};for(var i in itemsToUpdate){if(i==="options"){continue}if(this.editorPathMapping[i]===undefined){throw'Error. Item "'+i+'" is not in editor path mapping'}if(i==="language_id"){pathElementsOrdered[i]=[crowdin.editor.source_language.internal_code,itemsToUpdate[i]].join("-")}else{pathElementsOrdered[i]=itemsToUpdate[i]}}var result=[];for(var j in pathElementsOrdered){if(pathElementsOrdered[j]){result.push(pathElementsOrdered[j])}else{break}}var url="/"+result.join("/");if(options){if(options.preserve_search_query){url=this.preserveSearchParams(url)}if(options.hash){url+="#"+itemsToUpdate.options.hash}if(options.preserve_hash&&!options.hash){url=this.preserveHashParams(url)}}return url}},{key:"build",value:function build(url,queryParams,hash){queryParams=queryParams||null;hash=hash||"";if(queryParams&&Object.keys(queryParams).length){var queryString=Object.keys(queryParams).map((function(key){return key+"="+queryParams[key]})).join("&");var queryUrlSign=url.indexOf("?")!==-1?"&":"?";url+=queryUrlSign+queryString}if(hash){url+="#"+hash}return encodeURI(url)}},{key:"redirect",value:function redirect(url){window.location.href=url}},{key:"reload",value:function reload(){window.location.reload()}},{key:"deleteSearchParam",value:function deleteSearchParam(parameterName,url){var url=url||this.buildEditorPath();if(!parameterName){return url}var result="",tmp=[];var items=this.getSearchParams().substr(1).split("&");for(var index=0;index<items.length;index++){tmp=items[index].split("=");if(tmp[0]!==parameterName){result+="&"+items[index]}}if(result){result="?"+result.substr(1)}return url.replace(this.getSearchParams(),result)}},{key:"getPathElements",value:function getPathElements(){return window.location.pathname.split("/")}},{key:"getSearchParams",value:function getSearchParams(){return window.location.search}},{key:"getSearchParamsObj",value:function getSearchParamsObj(){var params={},tokens,regex=/[?&]?([^=]+)=([^&]*)/g;while(tokens=regex.exec(this.getSearchParams())){params[decodeURIComponent(tokens[1])]=decodeURIComponent(tokens[2])}return params}},{key:"getHashParams",value:function getHashParams(){return window.location.hash}},{key:"preserveSearchParams",value:function preserveSearchParams(path){return path+this.getSearchParams()}},{key:"preserveHashParams",value:function preserveHashParams(url){return url+this.getHashParams()}},{key:"getHashObj",value:function getHashObj(param){var hashParams={},r=/([^&;=]+)=([^&]*)/g,d=function d(s){return urldecode(s)},q=this.getHashParams().substring(1),e;while(e=r.exec(q)){hashParams[d(e[1])]=d(e[2])}if(param){return param in hashParams?hashParams[param]:null}return hashParams}},{key:"getQueryFromUrl",value:function getQueryFromUrl(){var returnWithParam=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var hashParts=this.getHashParams().substr(1).split(":"),query="",hashH,queryQ;if(hashParts.length){if(parseInt(hashParts[0])){query=hashParts[0]}else if(hashH=this.getHashObj("h")){query="h="+hashH}else if(queryQ=this.getHashObj("q")){query=(returnWithParam?"q=":"")+queryQ}}return query}},{key:"getProjectLanguageUrl",value:function getProjectLanguageUrl(){var _crowdin$editor=crowdin.editor,project=_crowdin$editor.project,modeReview=_crowdin$editor.modeReview,targetLanguage=_crowdin$editor.target_language;var url=project.url;var additionalUrl=IS_ENTERPRISE?"/l":"";if(modeReview()){return url}if(targetLanguage){url+=additionalUrl+"/"+targetLanguage.code}return url}},{key:"getActivityUrl",value:function getActivityUrl(){var _crowdin$editor2=crowdin.editor,project=_crowdin$editor2.project,modeReview=_crowdin$editor2.modeReview,workflowStep=_crowdin$editor2.workflow_step,targetLanguage=_crowdin$editor2.target_language;var url=project.url;var activityUrl=IS_ENTERPRISE?"/activity":"/activity_stream";if(modeReview()){return url}url+=activityUrl;if(targetLanguage){url+="?lang="+targetLanguage.id}if(workflowStep&&workflowStep.id){url+="&workflow_step_id="+workflowStep.id}return url}},{key:"getTaskDetailUrl",value:function getTaskDetailUrl(taskId){return"".concat(crowdin.editor.project.url).concat(IS_ENTERPRISE?"/tasks/":"/task/").concat(taskId)}}]);return crowdin_url_helper}();
