"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var WorkflowMenuTab=function(_React$Component){_inherits(WorkflowMenuTab,_React$Component);var _super=_createSuper(WorkflowMenuTab);function WorkflowMenuTab(props){var _this;_classCallCheck(this,WorkflowMenuTab);_this=_super.call(this,props);_this.availableItems=[];return _this}_createClass(WorkflowMenuTab,[{key:"componentDidMount",value:function componentDidMount(){this.list.tabIndex=0;this.list.focus()}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){if(!prevProps.inFocus&&this.props.inFocus){this.list.tabIndex=0;this.list.focus()}}},{key:"getWorkflowErrorMessageTpl",value:function getWorkflowErrorMessageTpl(){if(crowdin.editor.isNotLoadedWorkflowStep()){var message=!INIT_MANAGERS.length?_l("languagesDialog.workflowStepIsIncorrectOwner"):_l("languagesDialog.workflowStepIsIncorrect",{className:"alert-link",url:"javascript:crowdin.plugins.contact_manager.run();"});return["div.alert",{innerHTML:message}]}if(crowdin.editor.isDisabledWorkflowStep()){var language=crowdin.editor.target_language?crowdin.editor.target_language.name:crowdin.editor.out_of_scope_target_lang.name;var _message=!INIT_MANAGERS.length?_l("workflowMenuDialog.languageOutOfStepScopeOwner",{language:language}):_l("workflowMenuDialog.languageOutOfStepScope",{language:language,url:"javascript:crowdin.plugins.contact_manager.run();"});return["div.alert",{innerHTML:_message}]}}},{key:"allowedLanguagesOnStepLabel",value:function allowedLanguagesOnStepLabel(workflowStep){var _crowdin$editor=crowdin.editor,project=_crowdin$editor.project,targetLanguage=_crowdin$editor.target_language;if(project.has_advanced_workflow&&targetLanguage){for(var i in workflowStep.languages){if(+workflowStep.languages[i].id===+targetLanguage.id){return null}}if(workflowStep.type=="outOfWorkflow"){return null}return["span.label label-disabled pull-right",{style:{verticalAlign:"middle"},title:_l("workflowMenuDialog.stepTitle",{language:targetLanguage.name})},"N/A"]}return null}},{key:"clickOnItem",value:function clickOnItem(e,item){e.preventDefault();var _crowdin$editor2=crowdin.editor,targetLanguage=_crowdin$editor2.target_language,outOfScopeTargetLanguage=_crowdin$editor2.out_of_scope_target_lang,currentEditorMode=_crowdin$editor2.mode,MODE_NAME_PROOFREAD=_crowdin$editor2.MODE_NAME_PROOFREAD,MODE_NAME_REVIEW=_crowdin$editor2.MODE_NAME_REVIEW,WF_STEP_TYPE_SOURCE_TEXT_REVIEW=_crowdin$editor2.WF_STEP_TYPE_SOURCE_TEXT_REVIEW;var pathLanguageId=targetLanguage?targetLanguage.internal_code:outOfScopeTargetLanguage.internal_code;if(currentEditorMode===MODE_NAME_REVIEW){if(item.type==="outOfWorkflow"){pathLanguageId=null}}var queryParams={step_chosen:""};if(currentEditorMode!==MODE_NAME_REVIEW&&item.editor_mode===MODE_NAME_REVIEW){pathLanguageId=item.languages[0].internal_code;delete queryParams.step_chosen}var path=crowdin.helpers.url.buildEditorPath({mode:item.editor_mode,workflow_step_id:item.id,language_id:pathLanguageId});if(currentEditorMode===item.editor_mode&&item.type!=="outOfWorkflow"&&item.type!==WF_STEP_TYPE_SOURCE_TEXT_REVIEW){crowdin.editor.changeWorkflowStep(item.id,true)}else{if(this.allowedLanguagesOnStepLabel(item)!==null){path=crowdin.helpers.url.build(path,queryParams)}crowdin.helpers.url.redirect(path)}}},{key:"render",value:function render(){var _this2=this;var currentWorkflowStep=crowdin.editor.workflow_step;this.availableItems=[];var workflowSteps=crowdin.editor.workflow_steps;var outOfWorkflowEditorItem=null;if(crowdin.user.is_manager||crowdin.user.is_owner){outOfWorkflowEditorItem={disabled:false,editor_mode:crowdin.editor.mode,id:null,languages:[],title:_l("editor.workflowMenu.allContent"),type:"outOfWorkflow"};workflowSteps=[outOfWorkflowEditorItem].concat(_toConsumableArray(workflowSteps))}workflowSteps.forEach((function(item,index){_this2.availableItems.push(index)}));if(outOfWorkflowEditorItem&&!_.find(workflowSteps,{divider:true})){workflowSteps.splice(1,0,{name:"",divider:true,disabled:true})}var result=workflowSteps.map((function(item,index){var selected=_this2.availableItems[_this2.props.selectedAvailableIndex]===index;var isCurrentStep=currentWorkflowStep&&item.id===currentWorkflowStep.id||item.type==="outOfWorkflow"&&crowdin.editor.isOutOfWorkflowEditorMode();var classNames="item "+(selected?" selected ":"")+(isCurrentStep?" checked":"");if(item.divider){return["li.divider",{key:"divider"}]}return["li",{className:classNames,onMouseEnter:function onMouseEnter(e){var selectedInd=_this2.availableItems.indexOf(index)>=0?_this2.availableItems.indexOf(index):null;_this2.props.itemOnHover(e,selectedInd)},onMouseLeave:function onMouseLeave(e){return _this2.props.itemOnHover(e)},"data-step-id":item.id,key:"step_"+index},["a.text-overflow",{href:"#",tabIndex:-1,onClick:function onClick(e){return _this2.clickOnItem(e,item)}},item.title,_this2.allowedLanguagesOnStepLabel(item)]]}));return ReactCompile(["div.content",{key:"crowdin-editor-workflow-title",ref:function ref(list){return _this2.list=list},onKeyDown:function onKeyDown(e){return _this2.props.subMenuHandleKey(e,result,_this2)}},["h3",_l("generic.workflow")],this.getWorkflowErrorMessageTpl(),["ul.nav nav-list",result]])}}]);return WorkflowMenuTab}(React.Component);
